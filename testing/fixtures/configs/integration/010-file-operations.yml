- name: Create test directory
  file:
    path: /tmp/mooncake-test-dir
    state: directory

- name: Verify directory exists
  shell: test -d /tmp/mooncake-test-dir

- name: Create file in directory
  file:
    path: /tmp/mooncake-test-dir/test.txt
    state: touch

- name: Write content to file
  shell: echo "test content" > /tmp/mooncake-test-dir/test.txt

- name: Read file content
  shell: cat /tmp/mooncake-test-dir/test.txt
  register: content

- name: Verify content
  shell: test "{{ content.stdout }}" = "test content"

- name: Create another file
  file:
    path: /tmp/mooncake-test-dir/test2.txt
    state: touch

- name: List files in directory
  shell: ls /tmp/mooncake-test-dir
  register: files

- name: Clean up directory
  file:
    path: /tmp/mooncake-test-dir
    state: absent

- name: Verify cleanup
  shell: test ! -d /tmp/mooncake-test-dir
