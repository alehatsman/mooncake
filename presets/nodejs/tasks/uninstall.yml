# Node.js/nvm Uninstallation

- name: Remove nvm directory
  file:
    path: "~/.nvm"
    state: absent
  when: parameters.state == "absent"

- name: Remove nvm init file
  file:
    path: "~/.nvm_init"
    state: absent
  when: parameters.state == "absent"

- name: Remove nvm from shell profiles
  shell: |
    for profile in "~/.bashrc" "~/.zshrc" "~/.profile"; do
      if [ -f "$profile" ]; then
        # Remove lines that source .nvm_init
        sed -i.bak '/.nvm_init/d' "$profile" 2>/dev/null || \
        sed -i '' '/.nvm_init/d' "$profile" 2>/dev/null || true
      fi
    done
  when: parameters.state == "absent"

- name: Assert nvm is removed
  assert:
    file:
      path: "~/.nvm/nvm.sh"
      exists: false
  when: parameters.state == "absent"

- name: Print uninstallation complete
  print: |
    nvm and Node.js have been uninstalled.

    Note: npm global packages were removed with Node.js.
    Restart your terminal for changes to take effect.
  when: parameters.state == "absent"
