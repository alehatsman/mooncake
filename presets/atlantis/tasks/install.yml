- name: Check if atlantis is installed
  shell: command -v atlantis
  register: atlantis_check
  failed_when: false

- name: Install atlantis via Homebrew
  package:
    name: atlantis
    state: present
  when: brew_available and atlantis_check.rc != 0

- name: Install atlantis via curl script
  shell: |
    curl -LOs https://github.com/runatlantis/atlantis/releases/latest/download/atlantis_linux_amd64.tar.gz
    tar -xzf atlantis_linux_amd64.tar.gz
    sudo mv atlantis /usr/local/bin/
    rm atlantis_linux_amd64.tar.gz
  when: linux and atlantis_check.rc != 0

- name: Verify installation with assert
  assert:
    command:
      cmd: command -v atlantis
      exit_code: 0

- name: Display confirmation
  print: "atlantis installed"
