- name: Check if nvm is installed
  shell: test -f ~/.nvm/nvm.sh && echo "installed" || echo "not installed"
  register: nvm_check
  failed_when: false

- name: Install nvm via Homebrew (macOS)
  package:
    name: nvm
    state: present
  when: (parameters.state == "present") and (os == "darwin") and (nvm_check.stdout != "installed")

- name: Install nvm via install script (Linux)
  shell: curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.7/install.sh | bash
  when: (parameters.state == "present") and (os == "linux") and (nvm_check.stdout != "installed")

- name: Verify installation with assert
  assert:
    file:
      path: "~/.nvm/nvm.sh"
      exists: true

- name: Display confirmation
  print: "nvm installed"
