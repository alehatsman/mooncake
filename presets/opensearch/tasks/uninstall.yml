- name: Uninstall opensearch via Homebrew (macOS)
  package:
    name: opensearch
    state: absent
  when: (parameters.state == "absent") and (os == "darwin")
  failed_when: false

- name: Remove opensearch directory (Linux)
  shell: |
    sudo rm -rf /usr/share/opensearch
    sudo rm -f /usr/local/bin/opensearch
  become: true
  when: (parameters.state == "absent") and (os == "linux")
  failed_when: false

- name: Display confirmation
  print: "opensearch uninstalled"
  when: parameters.state == "absent"

- name: Assert tool is removed
  assert:
    command:
      cmd: command -v opensearch || test -d /usr/share/opensearch
      exit_code: 1
  when: parameters.state == "absent"
