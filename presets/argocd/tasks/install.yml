- name: Check if argocd is installed
  shell: command -v argocd
  register: argocd_check
  failed_when: false

- name: Install argocd via Homebrew
  package:
    name: argocd
    state: present
  when: brew_available and argocd_check.rc != 0

- name: Install argocd via install script
  shell: |
    curl -sSL -o argocd-linux-arm64 https://github.com/argoproj/argo-cd/releases/latest/download/argocd-linux-arm64
    sudo install -m 555 argocd-linux-arm64 /usr/local/bin/argocd
    rm argocd-linux-arm64
  when: (apt_available or dnf_available or yum_available or pacman_available or zypper_available or apk_available) and argocd_check.rc != 0

- name: Verify installation with assert
  assert:
    command:
      cmd: command -v argocd
      exit_code: 0

- name: Display confirmation
  print: "argocd installed"
