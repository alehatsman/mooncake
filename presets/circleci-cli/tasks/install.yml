- name: Check if circleci is installed
  shell: command -v circleci
  register: circleci_cli_check
  failed_when: false

- name: Install circleci via Homebrew
  package:
    name: circleci
    state: present
  when: brew_available and circleci_cli_check.rc != 0

- name: Install circleci via curl script
  shell: |
    curl -fLSs https://raw.githubusercontent.com/CircleCI-Public/circleci-cli/master/install.sh | bash
  when: (apt_available or dnf_available or yum_available or pacman_available or zypper_available or apk_available) and circleci_cli_check.rc != 0

- name: Verify installation with assert
  assert:
    command:
      cmd: command -v circleci
      exit_code: 0

- name: Display confirmation
  print: "circleci installed"
