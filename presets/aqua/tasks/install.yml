- name: Check if aqua is installed
  shell: command -v aqua
  register: aqua_check
  failed_when: false

- name: Install aqua via Homebrew
  package:
    name: aqua
    state: present
  when: brew_available and aqua_check.rc != 0

- name: Install aqua via apt
  shell: |
    curl -sSfL -O https://raw.githubusercontent.com/aquaproj/aqua-installer/v4.0.2/aqua-installer
    chmod +x aqua-installer
    ./aqua-installer
    sudo ln -sf ~/.local/share/aquaproj-aqua/bin/aqua /usr/local/bin/aqua
    rm -f aqua-installer
  when: linux and aqua_check.rc != 0

- name: Verify installation with assert
  assert:
    command:
      cmd: command -v aqua
      exit_code: 0

- name: Display confirmation
  print: "aqua installed"
