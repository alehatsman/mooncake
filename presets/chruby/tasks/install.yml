- name: Check if chruby is installed
  shell: test -f /usr/local/share/chruby/chruby.sh && echo "installed" || echo "not installed"
  register: chruby_check
  failed_when: false

- name: Install chruby via Homebrew
  package:
    name: chruby
    state: present
  when: brew_available and chruby_check.stdout == "not installed"

- name: Install chruby via apt
  package:
    name: chruby
    state: present
  become: true
  when: apt_available and chruby_check.stdout == "not installed"

- name: Verify installation with assert
  assert:
    file:
      path: /usr/local/share/chruby/chruby.sh
      exists: true

- name: Display confirmation
  print: "chruby installed"
