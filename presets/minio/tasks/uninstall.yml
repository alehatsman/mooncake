# MinIO Uninstallation Tasks

- name: Stop MinIO service (Linux)
  service:
    name: minio
    state: stopped
  become: true
  failed_when: false
  when: linux

- name: Disable MinIO service (Linux)
  service:
    name: minio
    enabled: false
  become: true
  failed_when: false
  when: linux

- name: Remove MinIO systemd service (Linux)
  file:
    path: /etc/systemd/system/minio.service
    state: absent
  become: true
  when: linux

- name: Reload systemd daemon (Linux)
  shell: systemctl daemon-reload
  become: true
  when: linux

- name: Stop MinIO server (macOS)
  shell: pkill -f "minio server"
  failed_when: false
  when: brew_available

# macOS Uninstallation
- name: Uninstall MinIO via Homebrew (macOS)
  package:
    name: minio/stable/minio
    state: absent
  when: brew_available

# Linux Uninstallation
- name: Remove MinIO binaries (Linux)
  file:
    path: "{{ item }}"
    state: absent
  become: true
  loop:
    - /usr/local/bin/minio
    - /usr/local/bin/mc
  when: linux

- name: Clean up log file
  file:
    path: /tmp/minio.log
    state: absent
  failed_when: false

- name: Verify uninstallation with assert
  assert:
    command:
      cmd: command -v minio
      exit_code: 1

- name: Display uninstall confirmation
  print: "MinIO has been uninstalled (data in {{ parameters.data_dir }} remains)"
