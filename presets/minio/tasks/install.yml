# MinIO Installation Tasks

- name: Check if MinIO is already installed
  shell: command -v minio
  register: minio_check
  failed_when: false

# macOS Installation
- name: Install MinIO via Homebrew (macOS)
  package:
    name: minio/stable/minio
    state: present
  when: os == "darwin" and minio_check.rc != 0

# Linux - Download binary
- name: Download MinIO server (Linux)
  download:
    url: https://dl.min.io/server/minio/release/linux-amd64/minio
    dest: /usr/local/bin/minio
    mode: "0755"
  become: true
  when: os == "linux" and minio_check.rc != 0

- name: Download MinIO client (mc)
  download:
    url: https://dl.min.io/client/mc/release/linux-amd64/mc
    dest: /usr/local/bin/mc
    mode: "0755"
  become: true
  when: os == "linux" and minio_check.rc != 0

# Verify installation
- name: Verify MinIO installation
  shell: minio --version
  register: minio_version

- name: Display MinIO version
  print: "MinIO installed: {{ minio_version.stdout }}"
