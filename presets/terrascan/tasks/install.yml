- name: Check if terrascan is installed
  shell: command -v terrascan
  register: terrascan_check
  failed_when: false

- name: Install terrascan (macOS)
  package:
    name: terrascan
    state: present
  when: os == "darwin" and terrascan_check.rc != 0

- name: Install terrascan (Linux)
  shell: |
    curl -L "$(curl -s https://api.github.com/repos/tenable/terrascan/releases/latest | grep -o -E "https://.+?_Linux_x86_64.tar.gz")" -o terrascan.tar.gz
    tar -xf terrascan.tar.gz terrascan
    sudo install terrascan /usr/local/bin
    rm terrascan terrascan.tar.gz
  when: os == "linux" and terrascan_check.rc != 0

- name: Verify installation with assert
  assert:
    command:
      cmd: command -v terrascan
      exit_code: 0

- name: Display confirmation
  print: "terrascan installed"
