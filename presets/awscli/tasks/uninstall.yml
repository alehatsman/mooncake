# AWS CLI Uninstallation Tasks

# macOS Uninstallation
- name: Uninstall AWS CLI via Homebrew (macOS)
  package:
    name: awscli
    state: absent
  when: brew_available

# Linux Uninstallation (v2)
- name: Remove AWS CLI installation (Linux)
  file:
    path: /usr/local/aws-cli
    state: absent
  become: true
  when: linux and parameters.version == "2"

- name: Remove AWS CLI symlinks (Linux)
  file:
    path: "{{ item }}"
    state: absent
  become: true
  loop:
    - /usr/local/bin/aws
    - /usr/local/bin/aws_completer
  when: linux and parameters.version == "2"

# Uninstall v1 via pip
- name: Uninstall AWS CLI v1 via pip
  shell: pip3 uninstall -y awscli
  failed_when: false
  when: parameters.version == "1"

- name: Display uninstall confirmation
  print: "AWS CLI has been uninstalled (configuration in ~/.aws remains)"

- name: Verify uninstallation with assert
  assert:
    command:
      cmd: command -v aws
      exit_code: 1
