- name: Check if terraform is installed
  shell: command -v terraform
  register: terraform_check
  failed_when: false

- name: Install terraform (macOS)
  package:
    name: terraform
    state: present
  when: brew_available and terraform_check.rc != 0

- name: Install terraform (Linux)
  shell: |
    wget -O- https://apt.releases.hashicorp.com/gpg | sudo gpg --dearmor -o /usr/share/keyrings/hashicorp-archive-keyring.gpg
    echo "deb [signed-by=/usr/share/keyrings/hashicorp-archive-keyring.gpg] https://apt.releases.hashicorp.com $(lsb_release -cs) main" | sudo tee /etc/apt/sources.list.d/hashicorp.list
    sudo apt-get update && sudo apt-get install -y terraform
  when: apt_available and terraform_check.rc != 0

- name: Verify installation with assert
  assert:
    command:
      cmd: command -v terraform
      exit_code: 0

- name: Display confirmation
  print: "terraform installed"
