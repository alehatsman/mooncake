# Terraform Additional Tools Installation

# TFLint
- name: Install TFLint (macOS)
  package:
    name: tflint
    state: present
  when: brew_available and parameters.install_tflint != false

- name: Install TFLint (Linux)
  shell: |
    curl -s https://raw.githubusercontent.com/terraform-linters/tflint/master/install_linux.sh | bash
  when: linux and parameters.install_tflint != false
  failed_when: false

- name: Verify TFLint installation
  shell: tflint --version 2>/dev/null && echo "OK TFLint installed" || true
  when: parameters.install_tflint != false
  failed_when: false

# tfsec
- name: Install tfsec (macOS)
  package:
    name: tfsec
    state: present
  when: brew_available and parameters.install_tfsec != false

- name: Install tfsec (Linux)
  shell: |
    curl -s https://raw.githubusercontent.com/aquasecurity/tfsec/master/scripts/install_linux.sh | bash
  when: linux and parameters.install_tfsec != false
  failed_when: false

- name: Verify tfsec installation
  shell: tfsec --version 2>/dev/null && echo "OK tfsec installed" || true
  when: parameters.install_tfsec != false
  failed_when: false

# terraform-docs
- name: Install terraform-docs (macOS)
  package:
    name: terraform-docs
    state: present
  when: brew_available and parameters.install_terraform_docs != false

- name: Install terraform-docs (Linux)
  shell: |
    curl -sSLo /tmp/terraform-docs.tar.gz https://github.com/terraform-docs/terraform-docs/releases/download/v0.16.0/terraform-docs-v0.16.0-linux-amd64.tar.gz
    tar -xzf /tmp/terraform-docs.tar.gz -C /tmp/
    sudo mv /tmp/terraform-docs /usr/local/bin/
    chmod +x /usr/local/bin/terraform-docs
  become: true
  when: linux and parameters.install_terraform_docs != false
  failed_when: false

- name: Verify terraform-docs installation
  shell: terraform-docs --version 2>/dev/null && echo "OK terraform-docs installed" || true
  when: parameters.install_terraform_docs != false
  failed_when: false

# Summary
- name: Display tools summary
  print: |

    OK Terraform toolchain configured

    Core tool:
      • Terraform installed

    Additional tools configured:
      • TFLint
      • tfsec
