- name: Check if gitlab-runner is installed
  shell: command -v gitlab-runner
  register: gitlab_runner_check
  failed_when: false

- name: Install gitlab-runner (macOS)
  package:
    name: gitlab-runner
    state: present
  when: brew_available and gitlab_runner_check.rc != 0

- name: Install gitlab-runner (Linux)
  shell: |
    curl -LJO "https://gitlab-runner-downloads.s3.amazonaws.com/latest/deb/gitlab-runner_arm64.deb"
    sudo dpkg -i gitlab-runner_arm64.deb
    rm gitlab-runner_arm64.deb
  when: apt_available and gitlab_runner_check.rc != 0

- name: Verify installation with assert
  assert:
    command:
      cmd: command -v gitlab-runner
      exit_code: 0

- name: Display confirmation
  print: "gitlab-runner installed"
