- name: Check if z is installed
  shell: test -f ~/.z.sh || test -f /usr/local/etc/profile.d/z.sh
  register: z_check
  failed_when: false

- name: Install z via Homebrew
  package:
    name: z
    state: present
  when: brew_available and z_check.rc != 0

- name: Install z via curl
  shell: |
    curl -fsSL https://raw.githubusercontent.com/rupa/z/master/z.sh -o ~/.z.sh
    chmod +x ~/.z.sh
  when: not brew_available and z_check.rc != 0

- name: Verify installation with assert
  assert:
    file:
      path: ~/.z.sh
      exists: true
  when: not brew_available

- name: Verify installation with assert
  assert:
    file:
      path: /usr/local/etc/profile.d/z.sh
      exists: true
  when: brew_available

- name: Display version
  print: "z installed"
