# Neovim Configuration Tasks

# Create config directory
- name: Create Neovim config directory
  file:
    path: ~/.config/nvim
    state: directory
    mode: "0755"

# Install Packer.nvim
- name: Install Packer.nvim
  shell: |
    if [ ! -d ~/.local/share/nvim/site/pack/packer/start/packer.nvim ]; then
      git clone --depth 1 https://github.com/wbthomason/packer.nvim \
        ~/.local/share/nvim/site/pack/packer/start/packer.nvim
    fi
  when: parameters.install_packer != false
  failed_when: false

- name: Display Packer installation status
  print: "OK Packer.nvim plugin manager installed"
  when: parameters.install_packer != false

# Install lazy.nvim
- name: Install lazy.nvim
  shell: |
    if [ ! -d ~/.local/share/nvim/lazy/lazy.nvim ]; then
      git clone --filter=blob:none https://github.com/folke/lazy.nvim.git --branch=stable \
        ~/.local/share/nvim/lazy/lazy.nvim
    fi
  when: parameters.install_lazy != false
  failed_when: false

- name: Display lazy.nvim installation status
  print: "OK lazy.nvim plugin manager installed"
  when: parameters.install_lazy != false

# Create basic init.lua
- name: Create basic init.lua
  file:
    path: ~/.config/nvim/init.lua
    state: touch
    mode: "0644"
  when: parameters.create_basic_config != false

- name: Write basic Neovim configuration
  shell: |
    cat > ~/.config/nvim/init.lua << 'EOF'
    -- Basic Neovim Configuration
    -- Generated by Mooncake

    -- Set leader key
    vim.g.mapleader = " "
    vim.g.maplocalleader = " "

    -- Basic settings
    vim.opt.number = true
    vim.opt.relativenumber = true
    vim.opt.mouse = 'a'
    vim.opt.ignorecase = true
    vim.opt.smartcase = true
    vim.opt.hlsearch = false
    vim.opt.wrap = true
    vim.opt.breakindent = true
    vim.opt.tabstop = 2
    vim.opt.shiftwidth = 2
    vim.opt.expandtab = true

    print("Neovim configured by Mooncake!")
    EOF
  when: parameters.create_basic_config != false

# Display configuration info
- name: Display Neovim setup info
  print: |
    Neovim configured successfully

    Configuration: ~/.config/nvim
    Packer.nvim: Installed
    LSP support: Installed
    Basic config: Created

    Launch: nvim
    Edit config: nvim ~/.config/nvim/init.lua
