# Java Uninstallation Tasks

- name: Uninstall OpenJDK (macOS)
  shell: brew uninstall openjdk@{{ parameters.version }}
  when: brew_available

- name: Uninstall OpenJDK (Debian/Ubuntu)
  package:
    name: "openjdk-{{ parameters.version }}-jdk"
    state: absent
  become: true
  when: apt_available

- name: Uninstall OpenJDK (RHEL/Fedora)
  package:
    name: "java-{{ parameters.version }}-openjdk-devel"
    state: absent
  become: true
  when: dnf_available or yum_available

- name: Remove Java environment file
  file:
    path: "~/.java_env"
    state: absent

- name: Remove Java env from shell profiles
  shell: |
    for profile in "$HOME/.bashrc" "$HOME/.zshrc" "$HOME/.profile"; do
      if [ -f "$profile" ]; then
        sed -i.bak '/\.java_env/d' "$profile" 2>/dev/null || sed -i '' '/\.java_env/d' "$profile"
      fi
    done
  failed_when: false

- name: Verify uninstallation with assert
  assert:
    command:
      cmd: command -v java
      exit_code: 1

- name: Display uninstall confirmation
  print: "Java uninstalled."
