# Ninja - Small Build System with Focus on Speed

Fast, small build system focused on speed, designed for large projects with lots of source files.

## Quick Start

```yaml
- preset: ninja
```

## Features

- **Extremely fast**: Optimized for minimal build times
- **Simple syntax**: Build files generated by higher-level tools
- **Minimal**: No built-in rules, just task execution
- **Parallel builds**: Automatic parallel execution
- **Incremental rebuilds**: Only rebuild what changed
- **Dependency tracking**: Accurate change detection
- **Cross-platform**: Linux, macOS, Windows

## Basic Usage

```bash
# Build project (looks for build.ninja)
ninja

# Build specific target
ninja mytarget

# Clean build artifacts
ninja -t clean

# Show build commands
ninja -v

# Dry run (show what would be built)
ninja -n

# Build with N parallel jobs
ninja -j4

# Show targets
ninja -t targets all
```

## Advanced Configuration

```yaml
# Install Ninja
- preset: ninja

# Generate build files with CMake
- name: Configure project with CMake
  shell: |
    cmake -B build -G Ninja \
      -DCMAKE_BUILD_TYPE=Release \
      -DCMAKE_INSTALL_PREFIX=/usr/local
  cwd: /app

# Build with Ninja
- name: Build project
  shell: ninja -C build
  cwd: /app

# Install binaries
- name: Install
  shell: ninja -C build install
  cwd: /app
  become: true
```

## Parameters

| Parameter | Type | Default | Description |
|-----------|------|---------|-------------|
| state | string | present | Install or remove Ninja |

## Platform Support

- ✅ Linux (apt, dnf, yum, pacman, zypper)
- ✅ macOS (Homebrew)
- ✅ Windows (winget, chocolatey, binary)

## Configuration

- **Build file**: `build.ninja` (in project root)
- **Generated by**: CMake, Meson, or other build generators
- **Not hand-written**: Ninja files typically generated, not written manually

## Real-World Examples

### CMake + Ninja Build
```yaml
# Complete build pipeline
- name: Install build tools
  preset: ninja

- name: Install CMake
  preset: cmake

- name: Configure with CMake
  shell: |
    cmake -B build -G Ninja \
      -DCMAKE_BUILD_TYPE=Release \
      -DCMAKE_C_COMPILER=clang \
      -DCMAKE_CXX_COMPILER=clang++
  cwd: /app

- name: Build with Ninja
  shell: ninja -C build -j{{ cpu_cores }}
  cwd: /app

- name: Run tests
  shell: ninja -C build test
  cwd: /app
```

### Meson + Ninja Build
```bash
# Setup with Meson
meson setup build --buildtype=release

# Build with Ninja
ninja -C build

# Install
sudo ninja -C build install
```

### Example build.ninja (generated)
```ninja
# Generated by CMake
rule CXX_COMPILER
  command = /usr/bin/c++ $DEFINES $INCLUDES $FLAGS -MD -MT $out -MF $DEP_FILE -o $out -c $in
  description = Building CXX object $out
  depfile = $DEP_FILE

build main.cpp.o: CXX_COMPILER ../src/main.cpp
  FLAGS = -O3 -std=c++17
  INCLUDES = -I../include

rule CXX_EXECUTABLE_LINKER
  command = /usr/bin/c++ $FLAGS -o $TARGET_FILE $in $LINK_FLAGS $LINK_LIBRARIES
  description = Linking CXX executable $TARGET_FILE

build myapp: CXX_EXECUTABLE_LINKER main.cpp.o utils.cpp.o
  TARGET_FILE = myapp
  LINK_LIBRARIES = -lpthread

default myapp
```

### CI/CD Integration
```yaml
# Fast builds in CI/CD
- name: Install Ninja
  preset: ninja

- name: Install dependencies
  shell: apt-get update && apt-get install -y cmake gcc g++
  become: true

- name: Configure project
  shell: cmake -B build -G Ninja -DCMAKE_BUILD_TYPE=Release
  cwd: /app

- name: Build
  shell: ninja -C build -j$(nproc)
  cwd: /app

- name: Test
  shell: ninja -C build test
  cwd: /app

- name: Package
  shell: ninja -C build package
  cwd: /app
```

### Cross-Compilation Example
```bash
# Setup cross-compilation toolchain
cmake -B build-arm -G Ninja \
  -DCMAKE_TOOLCHAIN_FILE=arm-linux-gnueabihf.cmake \
  -DCMAKE_BUILD_TYPE=Release

# Build for ARM
ninja -C build-arm
```

### Incremental Build Workflow
```bash
# Initial build
ninja

# Edit source file
vim src/main.cpp

# Rebuild (only changed files)
ninja
# Only recompiles main.cpp and relinks

# Clean specific target
ninja -t clean mytarget

# Rebuild from scratch
ninja -t clean && ninja
```

## Common Use Cases

### Large C++ Projects
```bash
# LLVM/Clang use Ninja
cmake -G Ninja -DCMAKE_BUILD_TYPE=Release ../llvm
ninja

# Chrome/Chromium use Ninja
gn gen out/Release
ninja -C out/Release chrome
```

### Android Development
```bash
# Android Open Source Project uses Ninja
source build/envsetup.sh
lunch aosp_arm64-eng
m -j$(nproc)  # Uses Ninja internally
```

### Rust Projects with CMake
```bash
# Combine Rust with C/C++ via CMake + Ninja
cmake -B build -G Ninja -DRUST_BUILD=ON
ninja -C build
```

## Build Options

```bash
# Verbose output (show all commands)
ninja -v

# Keep going even if some targets fail
ninja -k 0

# Explain why something is rebuilt
ninja -d explain

# Show dependency tree
ninja -t graph | dot -Tpng -o deps.png

# Show build statistics
ninja -t compdb

# Recompact build log
ninja -t recompact
```

## Performance Tips

```bash
# Use all CPU cores
ninja -j$(nproc)

# Limit concurrent jobs (avoid OOM)
ninja -j4

# Use ccache for faster rebuilds
export CC="ccache gcc"
export CXX="ccache g++"
cmake -B build -G Ninja
ninja -C build
```

## Agent Use

- Build large C/C++ projects with minimal wait times
- Integrate fast builds into CI/CD pipelines
- Generate optimized binaries for production deployment
- Cross-compile applications for multiple platforms
- Rebuild only changed components in monorepos
- Speed up iterative development with incremental builds

## Troubleshooting

### Build fails without error
```bash
# Use verbose mode
ninja -v

# Show what would be built
ninja -n

# Clean and rebuild
ninja -t clean && ninja
```

### Ninja file not found
```bash
# Verify build file exists
ls build.ninja

# Generate with CMake
cmake -B build -G Ninja

# Or with Meson
meson setup build
```

### Out of memory during build
```bash
# Limit parallel jobs
ninja -j2

# Or use swap
sudo fallocate -l 8G /swapfile
sudo chmod 600 /swapfile
sudo mkswap /swapfile
sudo swapon /swapfile
```

## Uninstall

```yaml
- preset: ninja
  with:
    state: absent
```

## Resources

- Official manual: https://ninja-build.org/manual.html
- GitHub: https://github.com/ninja-build/ninja
- CMake Ninja generator: https://cmake.org/cmake/help/latest/generator/Ninja.html
- Meson: https://mesonbuild.com/
- Search: "ninja build system tutorial", "cmake ninja", "meson ninja"
