- name: Check if dog is installed
  shell: command -v dog
  register: dog_check
  failed_when: false

- name: Install dog (macOS)
  shell: |
    curl -sL https://github.com/ogham/dog/releases/download/v0.1.0/dog-v0.1.0-aarch64-apple-darwin.zip -o /tmp/dog.zip
    unzip -q /tmp/dog.zip -d /tmp/
    sudo mv /tmp/bin/dog /usr/local/bin/
    sudo chmod +x /usr/local/bin/dog
    rm -rf /tmp/dog.zip /tmp/bin
  when: brew_available and dog_check.rc != 0

- name: Install dog (Linux)
  shell: |
    curl -sL https://github.com/ogham/dog/releases/download/v0.1.0/dog-v0.1.0-aarch64-unknown-linux-gnu.zip -o /tmp/dog.zip
    unzip -q /tmp/dog.zip -d /tmp/
    sudo mv /tmp/bin/dog /usr/local/bin/
    sudo chmod +x /usr/local/bin/dog
    rm -rf /tmp/dog.zip /tmp/bin
  when: linux and dog_check.rc != 0

- name: Verify installation with assert
  assert:
    command:
      cmd: command -v dog
      exit_code: 0

- name: Display confirmation
  print: "dog installed"
