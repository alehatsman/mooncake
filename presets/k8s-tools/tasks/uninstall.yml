# Kubernetes Tools Uninstallation

- name: Uninstall kubectl (macOS)
  package:
    name: kubectl
    state: absent
  when: brew_available
  failed_when: false

- name: Uninstall kubectl (Linux)
  file:
    path: /usr/local/bin/kubectl
    state: absent
  become: true
  when: linux
  failed_when: false

- name: Uninstall k9s (macOS)
  package:
    name: k9s
    state: absent
  when: brew_available
  failed_when: false

- name: Uninstall k9s (Linux)
  file:
    path: /usr/local/bin/k9s
    state: absent
  become: true
  when: linux
  failed_when: false

- name: Uninstall Helm (macOS)
  package:
    name: helm
    state: absent
  when: brew_available
  failed_when: false

- name: Uninstall Helm (Linux)
  file:
    path: /usr/local/bin/helm
    state: absent
  become: true
  when: linux
  failed_when: false

- name: Uninstall kubectx (macOS)
  package:
    name: kubectx
    state: absent
  when: brew_available
  failed_when: false

- name: Uninstall kubectx (Linux)
  file:
    path: /opt/kubectx
    state: absent
  become: true
  when: linux
  failed_when: false

- name: Remove kubectx symlink (Linux)
  file:
    path: /usr/local/bin/kubectx
    state: absent
  become: true
  when: linux
  failed_when: false

- name: Remove kubens symlink (Linux)
  file:
    path: /usr/local/bin/kubens
    state: absent
  become: true
  when: linux
  failed_when: false

- name: Remove krew directory
  file:
    path: ~/.krew
    state: absent
  failed_when: false

- name: Remove kubectl config directory
  file:
    path: ~/.kube
    state: absent
  failed_when: false

- name: Assert kubectl is removed
  assert:
    command:
      cmd: command -v kubectl
      exit_code: 1

- name: Assert k9s is removed
  assert:
    command:
      cmd: command -v k9s
      exit_code: 1

- name: Assert helm is removed
  assert:
    command:
      cmd: command -v helm
      exit_code: 1

- name: Display confirmation
  print: "Kubernetes tools uninstalled"
