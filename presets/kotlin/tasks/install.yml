- name: Check if kotlin is installed
  shell: command -v kotlin
  register: kotlin_check
  failed_when: false

- name: Install kotlin (macOS)
  package:
    name: kotlin
    state: present
  when: brew_available and kotlin_check.rc != 0

- name: Install kotlin (Linux)
  shell: |
    curl -sL https://github.com/JetBrains/kotlin/releases/latest/download/kotlin-compiler-2.0.0.zip -o /tmp/kotlin.zip
    unzip -o /tmp/kotlin.zip -d /tmp
    sudo mv /tmp/kotlinc /usr/local/
    sudo ln -sf /usr/local/kotlinc/bin/kotlin /usr/local/bin/kotlin
    sudo ln -sf /usr/local/kotlinc/bin/kotlinc /usr/local/bin/kotlinc
    rm /tmp/kotlin.zip
  when: linux and kotlin_check.rc != 0

- name: Verify installation with assert
  assert:
    command:
      cmd: command -v kotlin
      exit_code: 0

- name: Display confirmation
  print: "kotlin installed"
