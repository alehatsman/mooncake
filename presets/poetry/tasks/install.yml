- name: Check if poetry is installed
  shell: command -v poetry
  register: poetry_check
  failed_when: false

- name: Install poetry via Homebrew
  package:
    name: poetry
    state: present
  when: brew_available and poetry_check.rc != 0

- name: Install poetry via install script
  shell: curl -sSL https://install.python-poetry.org | python3 -
  when: linux and poetry_check.rc != 0

- name: Verify installation with assert
  assert:
    command:
      cmd: command -v poetry
      exit_code: 0

- name: Display confirmation
  print: "poetry installed"
