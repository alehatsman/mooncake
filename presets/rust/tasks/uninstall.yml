# Rust/rustup Uninstallation

- name: Run rustup self uninstall
  shell: rustup self uninstall -y
  failed_when: false

- name: Remove cargo directory
  shell: rm -rf "$HOME/.cargo"
  failed_when: false

- name: Remove rustup directory
  shell: rm -rf "$HOME/.rustup"
  failed_when: false

- name: Remove cargo init file
  shell: rm -f "$HOME/.cargo_init"
  failed_when: false

- name: Remove cargo env from shell profiles
  shell: |
    for profile in "$HOME/.bashrc" "$HOME/.zshrc" "$HOME/.profile"; do
      if [ -f "$profile" ]; then
        # Remove lines that source .cargo_init
        sed -i.bak '/.cargo_init/d' "$profile" 2>/dev/null || \
        sed -i '' '/.cargo_init/d' "$profile" 2>/dev/null || true
      fi
    done

- name: Verify uninstallation with assert
  assert:
    command:
      cmd: command -v rustc
      exit_code: 1

- name: Print uninstallation complete
  print: |
    Rust and rustup have been uninstalled.

    Restart your terminal for changes to take effect.
