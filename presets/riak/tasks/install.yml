- name: Check if riak is installed
  shell: command -v riak
  register: riak_check
  failed_when: false

- name: Install riak (macOS)
  package:
    name: riak
    state: present
  when: brew_available

- name: Install riak (Debian/Ubuntu)
  package:
    name: riak
    state: present
  become: true
  when: apt_available

- name: Install riak (RHEL/Fedora)
  package:
    name: riak
    state: present
  become: true
  when: (dnf_available | default(false)) or (yum_available | default(false))

- name: Verify installation
  shell: riak version 2>&1 || riak --version 2>&1 || echo "installed"
  register: riak_version

- name: Verify installation with assert
  assert:
    command:
      cmd: command -v riak
      exit_code: 0

- name: Display version
  print: "riak installed"
