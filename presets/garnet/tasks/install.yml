- name: Check if garnet is installed
  shell: command -v garnet
  register: garnet_check
  failed_when: false

- name: Install garnet (macOS)
  package:
    name: garnet
    state: present
  when: brew_available and garnet_check.rc != 0

- name: Install garnet (Linux)
  shell: |
    curl -sL https://github.com/microsoft/garnet/releases/latest/download/garnet-linux-arm64 -o /tmp/garnet
    sudo mv /tmp/garnet /usr/local/bin/garnet
    sudo chmod +x /usr/local/bin/garnet
  when: linux and garnet_check.rc != 0

- name: Verify installation with assert
  assert:
    command:
      cmd: command -v garnet
      exit_code: 0

- name: Display confirmation
  print: "garnet installed"
