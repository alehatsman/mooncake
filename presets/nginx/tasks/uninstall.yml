# Nginx Uninstallation Tasks

- name: Stop Nginx service (Linux)
  service:
    name: nginx
    state: stopped
  become: true
  failed_when: false
  when: (parameters.state == "absent") and (os == "linux")

- name: Stop Nginx service (macOS)
  shell: brew services stop nginx
  failed_when: false
  when: (parameters.state == "absent") and (os == "darwin")

# macOS Uninstallation
- name: Uninstall Nginx via Homebrew (macOS)
  package:
    name: nginx
    state: absent
  when: (parameters.state == "absent") and (os == "darwin")
  failed_when: false

# Linux Uninstallation
- name: Uninstall Nginx (Linux)
  package:
    name: nginx
    state: absent
  become: true
  when: (parameters.state == "absent") and (os == "linux")
  failed_when: false

- name: Display uninstall confirmation
  print: "Nginx has been uninstalled"
  when: parameters.state == "absent"

- name: Assert tool is removed
  assert:
    command:
      cmd: command -v nginx
      exit_code: 1
  when: parameters.state == "absent"
