{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://mooncake.dev/schemas/config.json",
  "title": "Mooncake Configuration Schema",
  "description": "JSON Schema for Mooncake configuration files",
  "oneOf": [
    {
      "type": "array",
      "items": {
        "$ref": "#/definitions/step"
      }
    },
    {
      "$ref": "#/definitions/runConfig"
    }
  ],
  "definitions": {
    "assert": {
      "type": "object",
      "description": "Verify conditions without changing system state",
      "properties": {
        "command": {
          "type": "object",
          "properties": {
            "cmd": {
              "type": "string"
            },
            "exit_code": {
              "type": "integer"
            }
          },
          "required": [
            "cmd"
          ],
          "additionalProperties": false
        },
        "file": {
          "type": "object",
          "properties": {
            "contains": {
              "type": "string"
            },
            "content": {
              "type": "string"
            },
            "exists": {
              "type": "boolean"
            },
            "group": {
              "type": "string"
            },
            "mode": {
              "type": "string",
              "pattern": "^[0-7]{3,4}$"
            },
            "owner": {
              "type": "string"
            },
            "path": {
              "type": "string"
            }
          },
          "required": [
            "path"
          ],
          "additionalProperties": false
        },
        "file_sha256": {
          "type": "object",
          "properties": {
            "checksum": {
              "type": "string"
            },
            "path": {
              "type": "string"
            }
          },
          "required": [
            "path",
            "checksum"
          ],
          "additionalProperties": false
        },
        "git_clean": {
          "type": "object",
          "properties": {
            "allow_untracked": {
              "type": "boolean"
            }
          },
          "additionalProperties": false
        },
        "git_diff": {
          "type": "object",
          "properties": {
            "cached": {
              "type": "boolean"
            },
            "expected_diff": {
              "type": "string"
            },
            "files": {
              "type": "string"
            }
          },
          "required": [
            "expected_diff"
          ],
          "additionalProperties": false
        },
        "http": {
          "type": "object",
          "properties": {
            "body": {
              "type": "string"
            },
            "body_equals": {
              "type": "string"
            },
            "contains": {
              "type": "string"
            },
            "headers": {
              "type": "object",
              "additionalProperties": true
            },
            "jsonpath": {
              "type": "string"
            },
            "jsonpath_value": {},
            "method": {
              "type": "string"
            },
            "status": {
              "type": "integer"
            },
            "timeout": {
              "type": "string",
              "pattern": "^[0-9]+(ns|us|\u00b5s|ms|s|m|h)$"
            },
            "url": {
              "type": "string"
            }
          },
          "required": [
            "url"
          ],
          "additionalProperties": false
        }
      },
      "additionalProperties": false,
      "x-category": "system",
      "x-supports-dry-run": true
    },
    "artifact_capture": {
      "type": "object",
      "description": "Capture file changes with enhanced metadata for LLM agents",
      "properties": {
        "name": {
          "type": "string",
          "description": "Name of the artifact (used for output directory)"
        },
        "output_dir": {
          "type": "string",
          "description": "Base directory for artifacts (default: './artifacts')"
        },
        "format": {
          "type": "string",
          "enum": [
            "json",
            "markdown",
            "both"
          ],
          "description": "Output format (json, markdown, or both)"
        },
        "capture_content": {
          "type": "boolean",
          "description": "Capture full file content before/after (default: false)"
        },
        "max_diff_size": {
          "type": "integer",
          "description": "Maximum diff size in bytes per file (default: 1MB)"
        },
        "include_checksums": {
          "type": "boolean",
          "description": "Include SHA256 checksums (default: true)"
        },
        "steps": {
          "type": "array",
          "description": "Steps to execute while capturing changes",
          "items": {
            "$ref": "#/definitions/step"
          }
        }
      },
      "required": [
        "name",
        "steps"
      ],
      "additionalProperties": false,
      "x-category": "system",
      "x-supports-dry-run": true
    },
    "artifact_validate": {
      "type": "object",
      "description": "Validate artifacts against constraints (change budgets)",
      "properties": {
        "artifact_file": {
          "type": "string",
          "description": "Path to artifact metadata JSON file"
        },
        "max_files": {
          "type": "integer",
          "description": "Maximum number of files allowed to change"
        },
        "max_lines_changed": {
          "type": "integer",
          "description": "Maximum total lines changed (added + removed)"
        },
        "max_file_size": {
          "type": "integer",
          "description": "Maximum file size in bytes after changes"
        },
        "require_tests": {
          "type": "boolean",
          "description": "Require test file changes when code files change"
        },
        "allowed_paths": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Glob patterns for allowed file paths"
        },
        "forbidden_paths": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Glob patterns for forbidden file paths"
        }
      },
      "required": [
        "artifact_file"
      ],
      "additionalProperties": false,
      "x-category": "system",
      "x-supports-dry-run": true
    },
    "command": {
      "type": "object",
      "description": "Execute commands directly without shell interpolation",
      "properties": {
        "argv": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "capture": {
          "type": "boolean"
        },
        "stdin": {
          "type": "string"
        }
      },
      "required": [
        "argv"
      ],
      "additionalProperties": false,
      "x-category": "command",
      "x-supports-dry-run": true,
      "x-supports-become": true,
      "x-version": "1.0.0"
    },
    "command_action": {
      "type": "object",
      "description": "Execute commands directly without shell interpolation",
      "properties": {
        "argv": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "capture": {
          "type": "boolean"
        },
        "stdin": {
          "type": "string"
        }
      },
      "required": [
        "argv"
      ],
      "additionalProperties": false,
      "x-category": "command",
      "x-supports-dry-run": true,
      "x-supports-become": true,
      "x-version": "1.0.0"
    },
    "copy": {
      "type": "object",
      "description": "Copy files with checksum verification and atomic writes",
      "properties": {
        "backup": {
          "type": "boolean"
        },
        "checksum": {
          "type": "string"
        },
        "dest": {
          "type": "string"
        },
        "force": {
          "type": "boolean"
        },
        "group": {
          "type": "string"
        },
        "mode": {
          "type": "string",
          "pattern": "^[0-7]{3,4}$"
        },
        "owner": {
          "type": "string"
        },
        "src": {
          "type": "string"
        }
      },
      "required": [
        "src",
        "dest"
      ],
      "additionalProperties": false,
      "x-implements-check": true,
      "x-category": "file",
      "x-supports-dry-run": true,
      "x-supports-become": true,
      "x-version": "1.0.0",
      "x-emits-events": [
        "file.copied"
      ]
    },
    "download": {
      "type": "object",
      "description": "Download files from URLs with checksum verification",
      "properties": {
        "backup": {
          "type": "boolean"
        },
        "checksum": {
          "type": "string"
        },
        "dest": {
          "type": "string"
        },
        "force": {
          "type": "boolean"
        },
        "headers": {
          "type": "object",
          "additionalProperties": true
        },
        "mode": {
          "type": "string",
          "pattern": "^[0-7]{3,4}$"
        },
        "retries": {
          "type": "integer",
          "minimum": 0,
          "maximum": 100
        },
        "timeout": {
          "type": "string",
          "pattern": "^[0-9]+(ns|us|\u00b5s|ms|s|m|h)$"
        },
        "url": {
          "type": "string"
        }
      },
      "required": [
        "url",
        "dest"
      ],
      "additionalProperties": false,
      "x-implements-check": true,
      "x-category": "network",
      "x-supports-dry-run": true,
      "x-supports-become": true,
      "x-version": "1.0.0",
      "x-emits-events": [
        "file.downloaded"
      ]
    },
    "file": {
      "type": "object",
      "description": "Manage files, directories, links, and permissions",
      "properties": {
        "backup": {
          "type": "boolean"
        },
        "content": {
          "type": "string"
        },
        "force": {
          "type": "boolean"
        },
        "group": {
          "type": "string",
          "description": "File group (groupname or GID)"
        },
        "mode": {
          "type": "string",
          "description": "File permissions (e.g., '0644', '0755')",
          "pattern": "^[0-7]{3,4}$"
        },
        "owner": {
          "type": "string",
          "description": "File owner (username or UID)"
        },
        "path": {
          "type": "string",
          "description": "File, directory, or symlink path (required)"
        },
        "recurse": {
          "type": "boolean"
        },
        "src": {
          "type": "string"
        },
        "state": {
          "type": "string",
          "description": "Desired file state (present: file exists, absent: removed, directory: dir exists, link: symlink, touch: update timestamp)",
          "enum": [
            "present",
            "absent",
            "directory",
            "link",
            "touch"
          ]
        }
      },
      "required": [
        "path"
      ],
      "additionalProperties": false,
      "x-implements-check": true,
      "x-category": "file",
      "x-supports-dry-run": true,
      "x-supports-become": true,
      "x-version": "1.0.0",
      "x-emits-events": [
        "file.created",
        "file.updated",
        "file.removed",
        "directory.created",
        "directory.removed",
        "link.created",
        "permissions.changed"
      ]
    },
    "file_delete_range": {
      "type": "object",
      "description": "Delete text between start and end anchor patterns in files",
      "additionalProperties": false,
      "x-implements-check": true,
      "x-category": "file",
      "x-supports-dry-run": true,
      "x-supports-become": true,
      "x-version": "1.0.0",
      "x-emits-events": [
        "file.updated"
      ]
    },
    "file_insert": {
      "type": "object",
      "description": "Insert text before or after anchor patterns in files",
      "additionalProperties": false,
      "x-implements-check": true,
      "x-category": "file",
      "x-supports-dry-run": true,
      "x-supports-become": true,
      "x-version": "1.0.0",
      "x-emits-events": [
        "file.updated"
      ]
    },
    "file_patch_apply": {
      "type": "object",
      "description": "Apply unified diff patches to files",
      "additionalProperties": false,
      "x-implements-check": true,
      "x-category": "file",
      "x-supports-dry-run": true,
      "x-supports-become": true,
      "x-version": "1.0.0",
      "x-emits-events": [
        "file.updated"
      ]
    },
    "file_replace": {
      "type": "object",
      "description": "Replace text in files using literal or regex patterns",
      "properties": {
        "allow_no_match": {
          "type": "boolean"
        },
        "backup": {
          "type": "boolean"
        },
        "count": {
          "type": "integer"
        },
        "flags": {
          "type": "object",
          "properties": {
            "case_insensitive": {
              "type": "boolean"
            },
            "multiline": {
              "type": "boolean"
            },
            "regex": {
              "type": "boolean"
            }
          },
          "additionalProperties": false
        },
        "path": {
          "type": "string"
        },
        "pattern": {
          "type": "string"
        },
        "replace": {
          "type": "string"
        }
      },
      "required": [
        "path",
        "pattern",
        "replace"
      ],
      "additionalProperties": false,
      "x-implements-check": true,
      "x-category": "file",
      "x-supports-dry-run": true,
      "x-supports-become": true,
      "x-version": "1.0.0",
      "x-emits-events": [
        "file.updated"
      ]
    },
    "include_vars": {
      "type": "string",
      "description": "Load variables from a YAML file",
      "additionalProperties": false,
      "x-category": "data",
      "x-supports-dry-run": true,
      "x-version": "1.0.0",
      "x-emits-events": [
        "variables.loaded"
      ]
    },
    "package": {
      "type": "object",
      "description": "Manage system packages (install/remove/update)",
      "properties": {
        "extra": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "manager": {
          "type": "string",
          "description": "Package manager (auto-detected if empty: apt, dnf, yum, pacman, zypper, apk, brew, port, choco, scoop)"
        },
        "name": {
          "type": "string",
          "description": "Package name (single package)"
        },
        "names": {
          "type": "array",
          "description": "Multiple packages to install/remove",
          "items": {
            "type": "string"
          }
        },
        "state": {
          "type": "string",
          "description": "Package state (present: installed, absent: removed, latest: install or upgrade)",
          "enum": [
            "present",
            "absent",
            "latest"
          ]
        },
        "update_cache": {
          "type": "boolean",
          "description": "Update package cache before operation (e.g., apt-get update)"
        },
        "upgrade": {
          "type": "boolean"
        }
      },
      "additionalProperties": false,
      "x-platforms": [
        "linux",
        "darwin",
        "windows",
        "freebsd"
      ],
      "x-requires-sudo": true,
      "x-implements-check": true,
      "x-category": "system",
      "x-supports-dry-run": true,
      "x-supports-become": true,
      "x-version": "1.0.0",
      "x-emits-events": [
        "package.managed"
      ]
    },
    "preset": {
      "type": "object",
      "description": "Execute a preset by expanding it into steps",
      "properties": {
        "name": {
          "type": "string"
        },
        "with": {
          "type": "object",
          "additionalProperties": true
        }
      },
      "required": [
        "name"
      ],
      "additionalProperties": false,
      "x-category": "system",
      "x-supports-dry-run": true
    },
    "print": {
      "type": "object",
      "description": "Display messages to the user",
      "properties": {
        "msg": {
          "type": "string"
        }
      },
      "additionalProperties": false,
      "x-category": "output",
      "x-supports-dry-run": true,
      "x-version": "1.0.0",
      "x-emits-events": [
        "print.message"
      ]
    },
    "repo_apply_patchset": {
      "type": "object",
      "description": "Apply multiple patches to multiple files atomically",
      "additionalProperties": false,
      "x-implements-check": true,
      "x-category": "file",
      "x-supports-dry-run": true,
      "x-supports-become": true,
      "x-version": "1.0.0",
      "x-emits-events": [
        "file.updated"
      ]
    },
    "repo_search": {
      "type": "object",
      "description": "Search codebase for patterns and output results in JSON format",
      "properties": {
        "glob": {
          "type": "string"
        },
        "ignore_dirs": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "max_results": {
          "type": "integer"
        },
        "output_file": {
          "type": "string"
        },
        "path": {
          "type": "string"
        },
        "pattern": {
          "type": "string"
        },
        "regex": {
          "type": "boolean"
        }
      },
      "required": [
        "pattern"
      ],
      "additionalProperties": false,
      "x-category": "file",
      "x-supports-dry-run": true,
      "x-version": "1.0.0"
    },
    "repo_tree": {
      "type": "object",
      "description": "Generate a JSON representation of directory structure",
      "properties": {
        "exclude_dirs": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "include_files": {
          "type": "boolean"
        },
        "max_depth": {
          "type": "integer"
        },
        "output_file": {
          "type": "string"
        },
        "path": {
          "type": "string"
        }
      },
      "additionalProperties": false,
      "x-category": "file",
      "x-supports-dry-run": true,
      "x-version": "1.0.0"
    },
    "runConfig": {
      "type": "object",
      "description": "Structured configuration with version, global variables, and steps",
      "properties": {
        "steps": {
          "type": "array",
          "description": "Configuration steps to execute",
          "items": {
            "$ref": "#/definitions/step"
          }
        },
        "vars": {
          "type": "object",
          "description": "Global variables available to all steps",
          "additionalProperties": true
        },
        "version": {
          "type": "string",
          "description": "Configuration schema version (e.g., '1.0')"
        }
      },
      "required": [
        "steps"
      ],
      "additionalProperties": false
    },
    "service": {
      "type": "object",
      "description": "Manage services across platforms (systemd, launchd, Windows)",
      "properties": {
        "daemon_reload": {
          "type": "boolean",
          "description": "Run 'systemctl daemon-reload' after unit file changes (systemd only)"
        },
        "dropin": {
          "type": "object",
          "properties": {
            "content": {
              "type": "string"
            },
            "name": {
              "type": "string"
            },
            "src_template": {
              "type": "string"
            }
          },
          "required": [
            "name"
          ],
          "additionalProperties": false
        },
        "enabled": {
          "type": "boolean",
          "description": "Enable service to start on boot (systemd: enable/disable, launchd: bootstrap/bootout)"
        },
        "name": {
          "type": "string",
          "description": "Service name (systemd: nginx, launchd: com.example.app)"
        },
        "state": {
          "type": "string",
          "description": "Desired service state",
          "enum": [
            "started",
            "stopped",
            "restarted",
            "reloaded"
          ]
        },
        "unit": {
          "type": "object",
          "properties": {
            "content": {
              "type": "string"
            },
            "dest": {
              "type": "string"
            },
            "mode": {
              "type": "string",
              "pattern": "^[0-7]{3,4}$"
            },
            "src_template": {
              "type": "string"
            }
          },
          "additionalProperties": false
        }
      },
      "required": [
        "name"
      ],
      "additionalProperties": false,
      "x-platforms": [
        "linux",
        "darwin",
        "windows"
      ],
      "x-requires-sudo": true,
      "x-implements-check": true,
      "x-category": "system",
      "x-supports-dry-run": true
    },
    "shell": {
      "type": "object",
      "description": "Execute shell commands",
      "properties": {
        "capture": {
          "type": "boolean",
          "description": "Capture command output (default: true). When false, output is only streamed"
        },
        "cmd": {
          "type": "string",
          "description": "Shell command to execute (required)"
        },
        "interpreter": {
          "type": "string",
          "description": "Shell interpreter (bash, sh, pwsh, cmd). Default: bash on Unix, pwsh on Windows",
          "enum": [
            "bash",
            "sh",
            "pwsh",
            "cmd"
          ]
        },
        "stdin": {
          "type": "string",
          "description": "Input to provide to the command via stdin"
        }
      },
      "additionalProperties": false,
      "x-category": "command",
      "x-supports-dry-run": true,
      "x-supports-become": true,
      "x-version": "1.0.0",
      "x-emits-events": [
        "step.stdout",
        "step.stderr"
      ]
    },
    "shell_action": {
      "type": "object",
      "description": "Execute shell commands",
      "properties": {
        "capture": {
          "type": "boolean",
          "description": "Capture command output (default: true). When false, output is only streamed"
        },
        "cmd": {
          "type": "string",
          "description": "Shell command to execute (required)"
        },
        "interpreter": {
          "type": "string",
          "description": "Shell interpreter (bash, sh, pwsh, cmd). Default: bash on Unix, pwsh on Windows",
          "enum": [
            "bash",
            "sh",
            "pwsh",
            "cmd"
          ]
        },
        "stdin": {
          "type": "string",
          "description": "Input to provide to the command via stdin"
        }
      },
      "additionalProperties": false,
      "x-category": "command",
      "x-supports-dry-run": true,
      "x-supports-become": true,
      "x-version": "1.0.0",
      "x-emits-events": [
        "step.stdout",
        "step.stderr"
      ]
    },
    "step": {
      "type": "object",
      "properties": {
        "assert": {
          "description": "Verify conditions without changing system state",
          "$ref": "#/definitions/assert"
        },
        "artifact_capture": {
          "description": "Capture file changes with enhanced metadata for LLM agents",
          "$ref": "#/definitions/artifact_capture"
        },
        "artifact_validate": {
          "description": "Validate artifacts against constraints (change budgets)",
          "$ref": "#/definitions/artifact_validate"
        },
        "become": {
          "type": "boolean",
          "description": "Execute with sudo privileges. Works with: shell, command, file, template"
        },
        "become_user": {
          "type": "string",
          "description": "\u26a0\ufe0f SHELL/COMMAND ONLY: User to become via sudo (e.g., 'root', 'postgres'). Works with 'shell' and 'command' actions. Ignored for file/template/include."
        },
        "changed_when": {
          "type": "string",
          "description": "Expression to override changed result"
        },
        "command": {
          "description": "Execute commands directly without shell interpolation",
          "$ref": "#/definitions/command"
        },
        "copy": {
          "description": "Copy files with checksum verification and atomic writes",
          "$ref": "#/definitions/copy"
        },
        "creates": {
          "type": "string",
          "description": "Skip step if this file path exists. Useful for idempotency (universal)"
        },
        "cwd": {
          "type": "string",
          "description": "Working directory for the step"
        },
        "download": {
          "description": "Download files from URLs with checksum verification",
          "$ref": "#/definitions/download"
        },
        "env": {
          "type": "object",
          "description": "Environment variables for the step",
          "additionalProperties": true
        },
        "failed_when": {
          "type": "string",
          "description": "Expression to override failure condition"
        },
        "file": {
          "description": "Manage files, directories, links, and permissions",
          "$ref": "#/definitions/file"
        },
        "file_delete_range": {
          "description": "Delete text between start and end anchor patterns in files",
          "$ref": "#/definitions/file_delete_range"
        },
        "file_insert": {
          "description": "Insert text before or after anchor patterns in files",
          "$ref": "#/definitions/file_insert"
        },
        "file_patch_apply": {
          "description": "Apply unified diff patches to files",
          "$ref": "#/definitions/file_patch_apply"
        },
        "file_replace": {
          "description": "Replace text in files using literal or regex patterns",
          "$ref": "#/definitions/file_replace"
        },
        "include": {
          "type": "string",
          "description": "Path to YAML file with steps to include"
        },
        "include_vars": {
          "description": "Load variables from YAML files",
          "$ref": "#/definitions/include_vars"
        },
        "name": {
          "type": "string",
          "description": "Name of the step (universal)"
        },
        "package": {
          "description": "Manage system packages (install/remove/update)",
          "$ref": "#/definitions/package"
        },
        "preset": {
          "description": "Execute a preset by expanding it into steps",
          "oneOf": [
            {
              "type": "string",
              "description": "preset (simple string format)"
            },
            {
              "description": "preset (structured object format)",
              "$ref": "#/definitions/preset"
            }
          ]
        },
        "print": {
          "description": "Display messages to the user",
          "$ref": "#/definitions/print"
        },
        "register": {
          "type": "string",
          "description": "Variable name to store step execution result (universal)"
        },
        "repo_apply_patchset": {
          "description": "Apply multiple patches to multiple files atomically",
          "$ref": "#/definitions/repo_apply_patchset"
        },
        "repo_search": {
          "description": "Search codebase for patterns and output results in JSON format",
          "$ref": "#/definitions/repo_search"
        },
        "repo_tree": {
          "description": "Generate a JSON representation of directory structure",
          "$ref": "#/definitions/repo_tree"
        },
        "retries": {
          "type": "integer",
          "description": "\u26a0\ufe0f SHELL/COMMAND ONLY: Number of retry attempts on failure. Works with 'shell' and 'command' actions. Ignored for file/template/include.",
          "minimum": 0,
          "maximum": 100
        },
        "retry_delay": {
          "type": "string",
          "description": "\u26a0\ufe0f SHELL/COMMAND ONLY: Delay between retry attempts (e.g., '1s', '5s'). Works with 'shell' and 'command' actions. Ignored for file/template/include.",
          "pattern": "^[0-9]+(ns|us|\u00b5s|ms|s|m|h)$"
        },
        "service": {
          "description": "Manage services across platforms (systemd, launchd, Windows)",
          "$ref": "#/definitions/service"
        },
        "shell": {
          "description": "Execute shell commands",
          "oneOf": [
            {
              "type": "string",
              "description": "shell (simple string format)"
            },
            {
              "description": "shell (structured object format)",
              "$ref": "#/definitions/shell"
            }
          ]
        },
        "tags": {
          "type": "array",
          "description": "Tags for filtering step execution (universal)",
          "items": {
            "type": "string"
          }
        },
        "template": {
          "description": "Render template files and write to destination",
          "$ref": "#/definitions/template"
        },
        "timeout": {
          "type": "string",
          "description": "\u26a0\ufe0f SHELL/COMMAND ONLY: Maximum execution time (e.g., '30s', '5m', '1h'). Works with 'shell' and 'command' actions. Ignored for file/template/include.",
          "pattern": "^[0-9]+(ns|us|\u00b5s|ms|s|m|h)$"
        },
        "unarchive": {
          "description": "Extract archive files (tar, tar.gz, zip) with path traversal protection",
          "$ref": "#/definitions/unarchive"
        },
        "unless": {
          "type": "string",
          "description": "Skip step if this command succeeds (exit code 0). Useful for idempotency (universal)"
        },
        "vars": {
          "description": "Set variables for use in subsequent steps",
          "$ref": "#/definitions/vars"
        },
        "wait": {
          "description": "Poll a condition until it becomes true or times out",
          "$ref": "#/definitions/wait"
        },
        "when": {
          "type": "string",
          "description": "Conditional expression for step execution (universal)"
        },
        "with_filetree": {
          "type": "string",
          "description": "Directory path for iterating over files (universal)"
        },
        "with_items": {
          "type": "string",
          "description": "Variable expression for iterating over items (universal)"
        }
      },
      "oneOf": [
        {
          "required": [
            "assert"
          ],
          "not": {
            "anyOf": [
              {
                "required": [
                  "command"
                ]
              },
              {
                "required": [
                  "copy"
                ]
              },
              {
                "required": [
                  "download"
                ]
              },
              {
                "required": [
                  "file"
                ]
              },
              {
                "required": [
                  "file_delete_range"
                ]
              },
              {
                "required": [
                  "file_insert"
                ]
              },
              {
                "required": [
                  "file_patch_apply"
                ]
              },
              {
                "required": [
                  "file_replace"
                ]
              },
              {
                "required": [
                  "include"
                ]
              },
              {
                "required": [
                  "include_vars"
                ]
              },
              {
                "required": [
                  "package"
                ]
              },
              {
                "required": [
                  "preset"
                ]
              },
              {
                "required": [
                  "print"
                ]
              },
              {
                "required": [
                  "repo_apply_patchset"
                ]
              },
              {
                "required": [
                  "repo_search"
                ]
              },
              {
                "required": [
                  "repo_tree"
                ]
              },
              {
                "required": [
                  "service"
                ]
              },
              {
                "required": [
                  "shell"
                ]
              },
              {
                "required": [
                  "template"
                ]
              },
              {
                "required": [
                  "unarchive"
                ]
              },
              {
                "required": [
                  "vars"
                ]
              },
              {
                "required": [
                  "wait"
                ]
              },
              {
                "required": [
                  "artifact_capture"
                ]
              },
              {
                "required": [
                  "artifact_validate"
                ]
              }
            ]
          }
        },
        {
          "required": [
            "command"
          ],
          "not": {
            "anyOf": [
              {
                "required": [
                  "assert"
                ]
              },
              {
                "required": [
                  "copy"
                ]
              },
              {
                "required": [
                  "download"
                ]
              },
              {
                "required": [
                  "file"
                ]
              },
              {
                "required": [
                  "file_delete_range"
                ]
              },
              {
                "required": [
                  "file_insert"
                ]
              },
              {
                "required": [
                  "file_patch_apply"
                ]
              },
              {
                "required": [
                  "file_replace"
                ]
              },
              {
                "required": [
                  "include"
                ]
              },
              {
                "required": [
                  "include_vars"
                ]
              },
              {
                "required": [
                  "package"
                ]
              },
              {
                "required": [
                  "preset"
                ]
              },
              {
                "required": [
                  "print"
                ]
              },
              {
                "required": [
                  "repo_apply_patchset"
                ]
              },
              {
                "required": [
                  "repo_search"
                ]
              },
              {
                "required": [
                  "repo_tree"
                ]
              },
              {
                "required": [
                  "service"
                ]
              },
              {
                "required": [
                  "shell"
                ]
              },
              {
                "required": [
                  "template"
                ]
              },
              {
                "required": [
                  "unarchive"
                ]
              },
              {
                "required": [
                  "vars"
                ]
              },
              {
                "required": [
                  "wait"
                ]
              },
              {
                "required": [
                  "artifact_capture"
                ]
              },
              {
                "required": [
                  "artifact_validate"
                ]
              }
            ]
          }
        },
        {
          "required": [
            "copy"
          ],
          "not": {
            "anyOf": [
              {
                "required": [
                  "assert"
                ]
              },
              {
                "required": [
                  "command"
                ]
              },
              {
                "required": [
                  "download"
                ]
              },
              {
                "required": [
                  "file"
                ]
              },
              {
                "required": [
                  "file_delete_range"
                ]
              },
              {
                "required": [
                  "file_insert"
                ]
              },
              {
                "required": [
                  "file_patch_apply"
                ]
              },
              {
                "required": [
                  "file_replace"
                ]
              },
              {
                "required": [
                  "include"
                ]
              },
              {
                "required": [
                  "include_vars"
                ]
              },
              {
                "required": [
                  "package"
                ]
              },
              {
                "required": [
                  "preset"
                ]
              },
              {
                "required": [
                  "print"
                ]
              },
              {
                "required": [
                  "repo_apply_patchset"
                ]
              },
              {
                "required": [
                  "repo_search"
                ]
              },
              {
                "required": [
                  "repo_tree"
                ]
              },
              {
                "required": [
                  "service"
                ]
              },
              {
                "required": [
                  "shell"
                ]
              },
              {
                "required": [
                  "template"
                ]
              },
              {
                "required": [
                  "unarchive"
                ]
              },
              {
                "required": [
                  "vars"
                ]
              },
              {
                "required": [
                  "wait"
                ]
              },
              {
                "required": [
                  "artifact_capture"
                ]
              },
              {
                "required": [
                  "artifact_validate"
                ]
              }
            ]
          }
        },
        {
          "required": [
            "download"
          ],
          "not": {
            "anyOf": [
              {
                "required": [
                  "assert"
                ]
              },
              {
                "required": [
                  "command"
                ]
              },
              {
                "required": [
                  "copy"
                ]
              },
              {
                "required": [
                  "file"
                ]
              },
              {
                "required": [
                  "file_delete_range"
                ]
              },
              {
                "required": [
                  "file_insert"
                ]
              },
              {
                "required": [
                  "file_patch_apply"
                ]
              },
              {
                "required": [
                  "file_replace"
                ]
              },
              {
                "required": [
                  "include"
                ]
              },
              {
                "required": [
                  "include_vars"
                ]
              },
              {
                "required": [
                  "package"
                ]
              },
              {
                "required": [
                  "preset"
                ]
              },
              {
                "required": [
                  "print"
                ]
              },
              {
                "required": [
                  "repo_apply_patchset"
                ]
              },
              {
                "required": [
                  "repo_search"
                ]
              },
              {
                "required": [
                  "repo_tree"
                ]
              },
              {
                "required": [
                  "service"
                ]
              },
              {
                "required": [
                  "shell"
                ]
              },
              {
                "required": [
                  "template"
                ]
              },
              {
                "required": [
                  "unarchive"
                ]
              },
              {
                "required": [
                  "vars"
                ]
              },
              {
                "required": [
                  "wait"
                ]
              },
              {
                "required": [
                  "artifact_capture"
                ]
              },
              {
                "required": [
                  "artifact_validate"
                ]
              }
            ]
          }
        },
        {
          "required": [
            "file"
          ],
          "not": {
            "anyOf": [
              {
                "required": [
                  "assert"
                ]
              },
              {
                "required": [
                  "command"
                ]
              },
              {
                "required": [
                  "copy"
                ]
              },
              {
                "required": [
                  "download"
                ]
              },
              {
                "required": [
                  "file_delete_range"
                ]
              },
              {
                "required": [
                  "file_insert"
                ]
              },
              {
                "required": [
                  "file_patch_apply"
                ]
              },
              {
                "required": [
                  "file_replace"
                ]
              },
              {
                "required": [
                  "include"
                ]
              },
              {
                "required": [
                  "include_vars"
                ]
              },
              {
                "required": [
                  "package"
                ]
              },
              {
                "required": [
                  "preset"
                ]
              },
              {
                "required": [
                  "print"
                ]
              },
              {
                "required": [
                  "repo_apply_patchset"
                ]
              },
              {
                "required": [
                  "repo_search"
                ]
              },
              {
                "required": [
                  "repo_tree"
                ]
              },
              {
                "required": [
                  "service"
                ]
              },
              {
                "required": [
                  "shell"
                ]
              },
              {
                "required": [
                  "template"
                ]
              },
              {
                "required": [
                  "unarchive"
                ]
              },
              {
                "required": [
                  "vars"
                ]
              },
              {
                "required": [
                  "wait"
                ]
              },
              {
                "required": [
                  "artifact_capture"
                ]
              },
              {
                "required": [
                  "artifact_validate"
                ]
              }
            ]
          }
        },
        {
          "required": [
            "file_delete_range"
          ],
          "not": {
            "anyOf": [
              {
                "required": [
                  "assert"
                ]
              },
              {
                "required": [
                  "command"
                ]
              },
              {
                "required": [
                  "copy"
                ]
              },
              {
                "required": [
                  "download"
                ]
              },
              {
                "required": [
                  "file"
                ]
              },
              {
                "required": [
                  "file_insert"
                ]
              },
              {
                "required": [
                  "file_patch_apply"
                ]
              },
              {
                "required": [
                  "file_replace"
                ]
              },
              {
                "required": [
                  "include"
                ]
              },
              {
                "required": [
                  "include_vars"
                ]
              },
              {
                "required": [
                  "package"
                ]
              },
              {
                "required": [
                  "preset"
                ]
              },
              {
                "required": [
                  "print"
                ]
              },
              {
                "required": [
                  "repo_apply_patchset"
                ]
              },
              {
                "required": [
                  "repo_search"
                ]
              },
              {
                "required": [
                  "repo_tree"
                ]
              },
              {
                "required": [
                  "service"
                ]
              },
              {
                "required": [
                  "shell"
                ]
              },
              {
                "required": [
                  "template"
                ]
              },
              {
                "required": [
                  "unarchive"
                ]
              },
              {
                "required": [
                  "vars"
                ]
              },
              {
                "required": [
                  "wait"
                ]
              },
              {
                "required": [
                  "artifact_capture"
                ]
              },
              {
                "required": [
                  "artifact_validate"
                ]
              }
            ]
          }
        },
        {
          "required": [
            "file_insert"
          ],
          "not": {
            "anyOf": [
              {
                "required": [
                  "assert"
                ]
              },
              {
                "required": [
                  "command"
                ]
              },
              {
                "required": [
                  "copy"
                ]
              },
              {
                "required": [
                  "download"
                ]
              },
              {
                "required": [
                  "file"
                ]
              },
              {
                "required": [
                  "file_delete_range"
                ]
              },
              {
                "required": [
                  "file_patch_apply"
                ]
              },
              {
                "required": [
                  "file_replace"
                ]
              },
              {
                "required": [
                  "include"
                ]
              },
              {
                "required": [
                  "include_vars"
                ]
              },
              {
                "required": [
                  "package"
                ]
              },
              {
                "required": [
                  "preset"
                ]
              },
              {
                "required": [
                  "print"
                ]
              },
              {
                "required": [
                  "repo_apply_patchset"
                ]
              },
              {
                "required": [
                  "repo_search"
                ]
              },
              {
                "required": [
                  "repo_tree"
                ]
              },
              {
                "required": [
                  "service"
                ]
              },
              {
                "required": [
                  "shell"
                ]
              },
              {
                "required": [
                  "template"
                ]
              },
              {
                "required": [
                  "unarchive"
                ]
              },
              {
                "required": [
                  "vars"
                ]
              },
              {
                "required": [
                  "wait"
                ]
              },
              {
                "required": [
                  "artifact_capture"
                ]
              },
              {
                "required": [
                  "artifact_validate"
                ]
              }
            ]
          }
        },
        {
          "required": [
            "file_patch_apply"
          ],
          "not": {
            "anyOf": [
              {
                "required": [
                  "assert"
                ]
              },
              {
                "required": [
                  "command"
                ]
              },
              {
                "required": [
                  "copy"
                ]
              },
              {
                "required": [
                  "download"
                ]
              },
              {
                "required": [
                  "file"
                ]
              },
              {
                "required": [
                  "file_delete_range"
                ]
              },
              {
                "required": [
                  "file_insert"
                ]
              },
              {
                "required": [
                  "file_replace"
                ]
              },
              {
                "required": [
                  "include"
                ]
              },
              {
                "required": [
                  "include_vars"
                ]
              },
              {
                "required": [
                  "package"
                ]
              },
              {
                "required": [
                  "preset"
                ]
              },
              {
                "required": [
                  "print"
                ]
              },
              {
                "required": [
                  "repo_apply_patchset"
                ]
              },
              {
                "required": [
                  "repo_search"
                ]
              },
              {
                "required": [
                  "repo_tree"
                ]
              },
              {
                "required": [
                  "service"
                ]
              },
              {
                "required": [
                  "shell"
                ]
              },
              {
                "required": [
                  "template"
                ]
              },
              {
                "required": [
                  "unarchive"
                ]
              },
              {
                "required": [
                  "vars"
                ]
              },
              {
                "required": [
                  "wait"
                ]
              },
              {
                "required": [
                  "artifact_capture"
                ]
              },
              {
                "required": [
                  "artifact_validate"
                ]
              }
            ]
          }
        },
        {
          "required": [
            "file_replace"
          ],
          "not": {
            "anyOf": [
              {
                "required": [
                  "assert"
                ]
              },
              {
                "required": [
                  "command"
                ]
              },
              {
                "required": [
                  "copy"
                ]
              },
              {
                "required": [
                  "download"
                ]
              },
              {
                "required": [
                  "file"
                ]
              },
              {
                "required": [
                  "file_delete_range"
                ]
              },
              {
                "required": [
                  "file_insert"
                ]
              },
              {
                "required": [
                  "file_patch_apply"
                ]
              },
              {
                "required": [
                  "include"
                ]
              },
              {
                "required": [
                  "include_vars"
                ]
              },
              {
                "required": [
                  "package"
                ]
              },
              {
                "required": [
                  "preset"
                ]
              },
              {
                "required": [
                  "print"
                ]
              },
              {
                "required": [
                  "repo_apply_patchset"
                ]
              },
              {
                "required": [
                  "repo_search"
                ]
              },
              {
                "required": [
                  "repo_tree"
                ]
              },
              {
                "required": [
                  "service"
                ]
              },
              {
                "required": [
                  "shell"
                ]
              },
              {
                "required": [
                  "template"
                ]
              },
              {
                "required": [
                  "unarchive"
                ]
              },
              {
                "required": [
                  "vars"
                ]
              },
              {
                "required": [
                  "wait"
                ]
              },
              {
                "required": [
                  "artifact_capture"
                ]
              },
              {
                "required": [
                  "artifact_validate"
                ]
              }
            ]
          }
        },
        {
          "required": [
            "include"
          ],
          "not": {
            "anyOf": [
              {
                "required": [
                  "assert"
                ]
              },
              {
                "required": [
                  "command"
                ]
              },
              {
                "required": [
                  "copy"
                ]
              },
              {
                "required": [
                  "download"
                ]
              },
              {
                "required": [
                  "file"
                ]
              },
              {
                "required": [
                  "file_delete_range"
                ]
              },
              {
                "required": [
                  "file_insert"
                ]
              },
              {
                "required": [
                  "file_patch_apply"
                ]
              },
              {
                "required": [
                  "file_replace"
                ]
              },
              {
                "required": [
                  "include_vars"
                ]
              },
              {
                "required": [
                  "package"
                ]
              },
              {
                "required": [
                  "preset"
                ]
              },
              {
                "required": [
                  "print"
                ]
              },
              {
                "required": [
                  "repo_apply_patchset"
                ]
              },
              {
                "required": [
                  "repo_search"
                ]
              },
              {
                "required": [
                  "repo_tree"
                ]
              },
              {
                "required": [
                  "service"
                ]
              },
              {
                "required": [
                  "shell"
                ]
              },
              {
                "required": [
                  "template"
                ]
              },
              {
                "required": [
                  "unarchive"
                ]
              },
              {
                "required": [
                  "vars"
                ]
              },
              {
                "required": [
                  "wait"
                ]
              },
              {
                "required": [
                  "artifact_capture"
                ]
              },
              {
                "required": [
                  "artifact_validate"
                ]
              }
            ]
          }
        },
        {
          "required": [
            "include_vars"
          ],
          "not": {
            "anyOf": [
              {
                "required": [
                  "assert"
                ]
              },
              {
                "required": [
                  "command"
                ]
              },
              {
                "required": [
                  "copy"
                ]
              },
              {
                "required": [
                  "download"
                ]
              },
              {
                "required": [
                  "file"
                ]
              },
              {
                "required": [
                  "file_delete_range"
                ]
              },
              {
                "required": [
                  "file_insert"
                ]
              },
              {
                "required": [
                  "file_patch_apply"
                ]
              },
              {
                "required": [
                  "file_replace"
                ]
              },
              {
                "required": [
                  "include"
                ]
              },
              {
                "required": [
                  "package"
                ]
              },
              {
                "required": [
                  "preset"
                ]
              },
              {
                "required": [
                  "print"
                ]
              },
              {
                "required": [
                  "repo_apply_patchset"
                ]
              },
              {
                "required": [
                  "repo_search"
                ]
              },
              {
                "required": [
                  "repo_tree"
                ]
              },
              {
                "required": [
                  "service"
                ]
              },
              {
                "required": [
                  "shell"
                ]
              },
              {
                "required": [
                  "template"
                ]
              },
              {
                "required": [
                  "unarchive"
                ]
              },
              {
                "required": [
                  "vars"
                ]
              },
              {
                "required": [
                  "wait"
                ]
              },
              {
                "required": [
                  "artifact_capture"
                ]
              },
              {
                "required": [
                  "artifact_validate"
                ]
              }
            ]
          }
        },
        {
          "required": [
            "package"
          ],
          "not": {
            "anyOf": [
              {
                "required": [
                  "assert"
                ]
              },
              {
                "required": [
                  "command"
                ]
              },
              {
                "required": [
                  "copy"
                ]
              },
              {
                "required": [
                  "download"
                ]
              },
              {
                "required": [
                  "file"
                ]
              },
              {
                "required": [
                  "file_delete_range"
                ]
              },
              {
                "required": [
                  "file_insert"
                ]
              },
              {
                "required": [
                  "file_patch_apply"
                ]
              },
              {
                "required": [
                  "file_replace"
                ]
              },
              {
                "required": [
                  "include"
                ]
              },
              {
                "required": [
                  "include_vars"
                ]
              },
              {
                "required": [
                  "preset"
                ]
              },
              {
                "required": [
                  "print"
                ]
              },
              {
                "required": [
                  "repo_apply_patchset"
                ]
              },
              {
                "required": [
                  "repo_search"
                ]
              },
              {
                "required": [
                  "repo_tree"
                ]
              },
              {
                "required": [
                  "service"
                ]
              },
              {
                "required": [
                  "shell"
                ]
              },
              {
                "required": [
                  "template"
                ]
              },
              {
                "required": [
                  "unarchive"
                ]
              },
              {
                "required": [
                  "vars"
                ]
              },
              {
                "required": [
                  "wait"
                ]
              },
              {
                "required": [
                  "artifact_capture"
                ]
              },
              {
                "required": [
                  "artifact_validate"
                ]
              }
            ]
          }
        },
        {
          "required": [
            "preset"
          ],
          "not": {
            "anyOf": [
              {
                "required": [
                  "assert"
                ]
              },
              {
                "required": [
                  "command"
                ]
              },
              {
                "required": [
                  "copy"
                ]
              },
              {
                "required": [
                  "download"
                ]
              },
              {
                "required": [
                  "file"
                ]
              },
              {
                "required": [
                  "file_delete_range"
                ]
              },
              {
                "required": [
                  "file_insert"
                ]
              },
              {
                "required": [
                  "file_patch_apply"
                ]
              },
              {
                "required": [
                  "file_replace"
                ]
              },
              {
                "required": [
                  "include"
                ]
              },
              {
                "required": [
                  "include_vars"
                ]
              },
              {
                "required": [
                  "package"
                ]
              },
              {
                "required": [
                  "print"
                ]
              },
              {
                "required": [
                  "repo_apply_patchset"
                ]
              },
              {
                "required": [
                  "repo_search"
                ]
              },
              {
                "required": [
                  "repo_tree"
                ]
              },
              {
                "required": [
                  "service"
                ]
              },
              {
                "required": [
                  "shell"
                ]
              },
              {
                "required": [
                  "template"
                ]
              },
              {
                "required": [
                  "unarchive"
                ]
              },
              {
                "required": [
                  "vars"
                ]
              },
              {
                "required": [
                  "wait"
                ]
              },
              {
                "required": [
                  "artifact_capture"
                ]
              },
              {
                "required": [
                  "artifact_validate"
                ]
              }
            ]
          }
        },
        {
          "required": [
            "print"
          ],
          "not": {
            "anyOf": [
              {
                "required": [
                  "assert"
                ]
              },
              {
                "required": [
                  "command"
                ]
              },
              {
                "required": [
                  "copy"
                ]
              },
              {
                "required": [
                  "download"
                ]
              },
              {
                "required": [
                  "file"
                ]
              },
              {
                "required": [
                  "file_delete_range"
                ]
              },
              {
                "required": [
                  "file_insert"
                ]
              },
              {
                "required": [
                  "file_patch_apply"
                ]
              },
              {
                "required": [
                  "file_replace"
                ]
              },
              {
                "required": [
                  "include"
                ]
              },
              {
                "required": [
                  "include_vars"
                ]
              },
              {
                "required": [
                  "package"
                ]
              },
              {
                "required": [
                  "preset"
                ]
              },
              {
                "required": [
                  "repo_apply_patchset"
                ]
              },
              {
                "required": [
                  "repo_search"
                ]
              },
              {
                "required": [
                  "repo_tree"
                ]
              },
              {
                "required": [
                  "service"
                ]
              },
              {
                "required": [
                  "shell"
                ]
              },
              {
                "required": [
                  "template"
                ]
              },
              {
                "required": [
                  "unarchive"
                ]
              },
              {
                "required": [
                  "vars"
                ]
              },
              {
                "required": [
                  "wait"
                ]
              },
              {
                "required": [
                  "artifact_capture"
                ]
              },
              {
                "required": [
                  "artifact_validate"
                ]
              }
            ]
          }
        },
        {
          "required": [
            "repo_apply_patchset"
          ],
          "not": {
            "anyOf": [
              {
                "required": [
                  "assert"
                ]
              },
              {
                "required": [
                  "command"
                ]
              },
              {
                "required": [
                  "copy"
                ]
              },
              {
                "required": [
                  "download"
                ]
              },
              {
                "required": [
                  "file"
                ]
              },
              {
                "required": [
                  "file_delete_range"
                ]
              },
              {
                "required": [
                  "file_insert"
                ]
              },
              {
                "required": [
                  "file_patch_apply"
                ]
              },
              {
                "required": [
                  "file_replace"
                ]
              },
              {
                "required": [
                  "include"
                ]
              },
              {
                "required": [
                  "include_vars"
                ]
              },
              {
                "required": [
                  "package"
                ]
              },
              {
                "required": [
                  "preset"
                ]
              },
              {
                "required": [
                  "print"
                ]
              },
              {
                "required": [
                  "repo_search"
                ]
              },
              {
                "required": [
                  "repo_tree"
                ]
              },
              {
                "required": [
                  "service"
                ]
              },
              {
                "required": [
                  "shell"
                ]
              },
              {
                "required": [
                  "template"
                ]
              },
              {
                "required": [
                  "unarchive"
                ]
              },
              {
                "required": [
                  "vars"
                ]
              },
              {
                "required": [
                  "wait"
                ]
              },
              {
                "required": [
                  "artifact_capture"
                ]
              },
              {
                "required": [
                  "artifact_validate"
                ]
              }
            ]
          }
        },
        {
          "required": [
            "repo_search"
          ],
          "not": {
            "anyOf": [
              {
                "required": [
                  "assert"
                ]
              },
              {
                "required": [
                  "command"
                ]
              },
              {
                "required": [
                  "copy"
                ]
              },
              {
                "required": [
                  "download"
                ]
              },
              {
                "required": [
                  "file"
                ]
              },
              {
                "required": [
                  "file_delete_range"
                ]
              },
              {
                "required": [
                  "file_insert"
                ]
              },
              {
                "required": [
                  "file_patch_apply"
                ]
              },
              {
                "required": [
                  "file_replace"
                ]
              },
              {
                "required": [
                  "include"
                ]
              },
              {
                "required": [
                  "include_vars"
                ]
              },
              {
                "required": [
                  "package"
                ]
              },
              {
                "required": [
                  "preset"
                ]
              },
              {
                "required": [
                  "print"
                ]
              },
              {
                "required": [
                  "repo_apply_patchset"
                ]
              },
              {
                "required": [
                  "repo_tree"
                ]
              },
              {
                "required": [
                  "service"
                ]
              },
              {
                "required": [
                  "shell"
                ]
              },
              {
                "required": [
                  "template"
                ]
              },
              {
                "required": [
                  "unarchive"
                ]
              },
              {
                "required": [
                  "vars"
                ]
              },
              {
                "required": [
                  "wait"
                ]
              },
              {
                "required": [
                  "artifact_capture"
                ]
              },
              {
                "required": [
                  "artifact_validate"
                ]
              }
            ]
          }
        },
        {
          "required": [
            "repo_tree"
          ],
          "not": {
            "anyOf": [
              {
                "required": [
                  "assert"
                ]
              },
              {
                "required": [
                  "command"
                ]
              },
              {
                "required": [
                  "copy"
                ]
              },
              {
                "required": [
                  "download"
                ]
              },
              {
                "required": [
                  "file"
                ]
              },
              {
                "required": [
                  "file_delete_range"
                ]
              },
              {
                "required": [
                  "file_insert"
                ]
              },
              {
                "required": [
                  "file_patch_apply"
                ]
              },
              {
                "required": [
                  "file_replace"
                ]
              },
              {
                "required": [
                  "include"
                ]
              },
              {
                "required": [
                  "include_vars"
                ]
              },
              {
                "required": [
                  "package"
                ]
              },
              {
                "required": [
                  "preset"
                ]
              },
              {
                "required": [
                  "print"
                ]
              },
              {
                "required": [
                  "repo_apply_patchset"
                ]
              },
              {
                "required": [
                  "repo_search"
                ]
              },
              {
                "required": [
                  "service"
                ]
              },
              {
                "required": [
                  "shell"
                ]
              },
              {
                "required": [
                  "template"
                ]
              },
              {
                "required": [
                  "unarchive"
                ]
              },
              {
                "required": [
                  "vars"
                ]
              },
              {
                "required": [
                  "wait"
                ]
              },
              {
                "required": [
                  "artifact_capture"
                ]
              },
              {
                "required": [
                  "artifact_validate"
                ]
              }
            ]
          }
        },
        {
          "required": [
            "service"
          ],
          "not": {
            "anyOf": [
              {
                "required": [
                  "assert"
                ]
              },
              {
                "required": [
                  "command"
                ]
              },
              {
                "required": [
                  "copy"
                ]
              },
              {
                "required": [
                  "download"
                ]
              },
              {
                "required": [
                  "file"
                ]
              },
              {
                "required": [
                  "file_delete_range"
                ]
              },
              {
                "required": [
                  "file_insert"
                ]
              },
              {
                "required": [
                  "file_patch_apply"
                ]
              },
              {
                "required": [
                  "file_replace"
                ]
              },
              {
                "required": [
                  "include"
                ]
              },
              {
                "required": [
                  "include_vars"
                ]
              },
              {
                "required": [
                  "package"
                ]
              },
              {
                "required": [
                  "preset"
                ]
              },
              {
                "required": [
                  "print"
                ]
              },
              {
                "required": [
                  "repo_apply_patchset"
                ]
              },
              {
                "required": [
                  "repo_search"
                ]
              },
              {
                "required": [
                  "repo_tree"
                ]
              },
              {
                "required": [
                  "shell"
                ]
              },
              {
                "required": [
                  "template"
                ]
              },
              {
                "required": [
                  "unarchive"
                ]
              },
              {
                "required": [
                  "vars"
                ]
              },
              {
                "required": [
                  "wait"
                ]
              },
              {
                "required": [
                  "artifact_capture"
                ]
              },
              {
                "required": [
                  "artifact_validate"
                ]
              }
            ]
          }
        },
        {
          "required": [
            "shell"
          ],
          "not": {
            "anyOf": [
              {
                "required": [
                  "assert"
                ]
              },
              {
                "required": [
                  "command"
                ]
              },
              {
                "required": [
                  "copy"
                ]
              },
              {
                "required": [
                  "download"
                ]
              },
              {
                "required": [
                  "file"
                ]
              },
              {
                "required": [
                  "file_delete_range"
                ]
              },
              {
                "required": [
                  "file_insert"
                ]
              },
              {
                "required": [
                  "file_patch_apply"
                ]
              },
              {
                "required": [
                  "file_replace"
                ]
              },
              {
                "required": [
                  "include"
                ]
              },
              {
                "required": [
                  "include_vars"
                ]
              },
              {
                "required": [
                  "package"
                ]
              },
              {
                "required": [
                  "preset"
                ]
              },
              {
                "required": [
                  "print"
                ]
              },
              {
                "required": [
                  "repo_apply_patchset"
                ]
              },
              {
                "required": [
                  "repo_search"
                ]
              },
              {
                "required": [
                  "repo_tree"
                ]
              },
              {
                "required": [
                  "service"
                ]
              },
              {
                "required": [
                  "template"
                ]
              },
              {
                "required": [
                  "unarchive"
                ]
              },
              {
                "required": [
                  "vars"
                ]
              },
              {
                "required": [
                  "wait"
                ]
              },
              {
                "required": [
                  "artifact_capture"
                ]
              },
              {
                "required": [
                  "artifact_validate"
                ]
              }
            ]
          }
        },
        {
          "required": [
            "template"
          ],
          "not": {
            "anyOf": [
              {
                "required": [
                  "assert"
                ]
              },
              {
                "required": [
                  "command"
                ]
              },
              {
                "required": [
                  "copy"
                ]
              },
              {
                "required": [
                  "download"
                ]
              },
              {
                "required": [
                  "file"
                ]
              },
              {
                "required": [
                  "file_delete_range"
                ]
              },
              {
                "required": [
                  "file_insert"
                ]
              },
              {
                "required": [
                  "file_patch_apply"
                ]
              },
              {
                "required": [
                  "file_replace"
                ]
              },
              {
                "required": [
                  "include"
                ]
              },
              {
                "required": [
                  "include_vars"
                ]
              },
              {
                "required": [
                  "package"
                ]
              },
              {
                "required": [
                  "preset"
                ]
              },
              {
                "required": [
                  "print"
                ]
              },
              {
                "required": [
                  "repo_apply_patchset"
                ]
              },
              {
                "required": [
                  "repo_search"
                ]
              },
              {
                "required": [
                  "repo_tree"
                ]
              },
              {
                "required": [
                  "service"
                ]
              },
              {
                "required": [
                  "shell"
                ]
              },
              {
                "required": [
                  "unarchive"
                ]
              },
              {
                "required": [
                  "vars"
                ]
              },
              {
                "required": [
                  "wait"
                ]
              },
              {
                "required": [
                  "artifact_capture"
                ]
              },
              {
                "required": [
                  "artifact_validate"
                ]
              }
            ]
          }
        },
        {
          "required": [
            "unarchive"
          ],
          "not": {
            "anyOf": [
              {
                "required": [
                  "assert"
                ]
              },
              {
                "required": [
                  "command"
                ]
              },
              {
                "required": [
                  "copy"
                ]
              },
              {
                "required": [
                  "download"
                ]
              },
              {
                "required": [
                  "file"
                ]
              },
              {
                "required": [
                  "file_delete_range"
                ]
              },
              {
                "required": [
                  "file_insert"
                ]
              },
              {
                "required": [
                  "file_patch_apply"
                ]
              },
              {
                "required": [
                  "file_replace"
                ]
              },
              {
                "required": [
                  "include"
                ]
              },
              {
                "required": [
                  "include_vars"
                ]
              },
              {
                "required": [
                  "package"
                ]
              },
              {
                "required": [
                  "preset"
                ]
              },
              {
                "required": [
                  "print"
                ]
              },
              {
                "required": [
                  "repo_apply_patchset"
                ]
              },
              {
                "required": [
                  "repo_search"
                ]
              },
              {
                "required": [
                  "repo_tree"
                ]
              },
              {
                "required": [
                  "service"
                ]
              },
              {
                "required": [
                  "shell"
                ]
              },
              {
                "required": [
                  "template"
                ]
              },
              {
                "required": [
                  "vars"
                ]
              },
              {
                "required": [
                  "wait"
                ]
              },
              {
                "required": [
                  "artifact_capture"
                ]
              },
              {
                "required": [
                  "artifact_validate"
                ]
              }
            ]
          }
        },
        {
          "required": [
            "vars"
          ],
          "not": {
            "anyOf": [
              {
                "required": [
                  "assert"
                ]
              },
              {
                "required": [
                  "command"
                ]
              },
              {
                "required": [
                  "copy"
                ]
              },
              {
                "required": [
                  "download"
                ]
              },
              {
                "required": [
                  "file"
                ]
              },
              {
                "required": [
                  "file_delete_range"
                ]
              },
              {
                "required": [
                  "file_insert"
                ]
              },
              {
                "required": [
                  "file_patch_apply"
                ]
              },
              {
                "required": [
                  "file_replace"
                ]
              },
              {
                "required": [
                  "include"
                ]
              },
              {
                "required": [
                  "include_vars"
                ]
              },
              {
                "required": [
                  "package"
                ]
              },
              {
                "required": [
                  "preset"
                ]
              },
              {
                "required": [
                  "print"
                ]
              },
              {
                "required": [
                  "repo_apply_patchset"
                ]
              },
              {
                "required": [
                  "repo_search"
                ]
              },
              {
                "required": [
                  "repo_tree"
                ]
              },
              {
                "required": [
                  "service"
                ]
              },
              {
                "required": [
                  "shell"
                ]
              },
              {
                "required": [
                  "template"
                ]
              },
              {
                "required": [
                  "unarchive"
                ]
              },
              {
                "required": [
                  "wait"
                ]
              },
              {
                "required": [
                  "artifact_capture"
                ]
              },
              {
                "required": [
                  "artifact_validate"
                ]
              }
            ]
          }
        },
        {
          "required": [
            "wait"
          ],
          "not": {
            "anyOf": [
              {
                "required": [
                  "assert"
                ]
              },
              {
                "required": [
                  "command"
                ]
              },
              {
                "required": [
                  "copy"
                ]
              },
              {
                "required": [
                  "download"
                ]
              },
              {
                "required": [
                  "file"
                ]
              },
              {
                "required": [
                  "file_delete_range"
                ]
              },
              {
                "required": [
                  "file_insert"
                ]
              },
              {
                "required": [
                  "file_patch_apply"
                ]
              },
              {
                "required": [
                  "file_replace"
                ]
              },
              {
                "required": [
                  "include"
                ]
              },
              {
                "required": [
                  "include_vars"
                ]
              },
              {
                "required": [
                  "package"
                ]
              },
              {
                "required": [
                  "preset"
                ]
              },
              {
                "required": [
                  "print"
                ]
              },
              {
                "required": [
                  "repo_apply_patchset"
                ]
              },
              {
                "required": [
                  "repo_search"
                ]
              },
              {
                "required": [
                  "repo_tree"
                ]
              },
              {
                "required": [
                  "service"
                ]
              },
              {
                "required": [
                  "shell"
                ]
              },
              {
                "required": [
                  "template"
                ]
              },
              {
                "required": [
                  "unarchive"
                ]
              },
              {
                "required": [
                  "vars"
                ]
              },
              {
                "required": [
                  "artifact_capture"
                ]
              },
              {
                "required": [
                  "artifact_validate"
                ]
              }
            ]
          }
        },
        {
          "required": [
            "artifact_capture"
          ],
          "not": {
            "anyOf": [
              {
                "required": [
                  "assert"
                ]
              },
              {
                "required": [
                  "artifact_validate"
                ]
              },
              {
                "required": [
                  "command"
                ]
              },
              {
                "required": [
                  "copy"
                ]
              },
              {
                "required": [
                  "download"
                ]
              },
              {
                "required": [
                  "file"
                ]
              },
              {
                "required": [
                  "file_delete_range"
                ]
              },
              {
                "required": [
                  "file_insert"
                ]
              },
              {
                "required": [
                  "file_patch_apply"
                ]
              },
              {
                "required": [
                  "file_replace"
                ]
              },
              {
                "required": [
                  "include"
                ]
              },
              {
                "required": [
                  "include_vars"
                ]
              },
              {
                "required": [
                  "package"
                ]
              },
              {
                "required": [
                  "preset"
                ]
              },
              {
                "required": [
                  "print"
                ]
              },
              {
                "required": [
                  "repo_apply_patchset"
                ]
              },
              {
                "required": [
                  "repo_search"
                ]
              },
              {
                "required": [
                  "repo_tree"
                ]
              },
              {
                "required": [
                  "service"
                ]
              },
              {
                "required": [
                  "shell"
                ]
              },
              {
                "required": [
                  "template"
                ]
              },
              {
                "required": [
                  "unarchive"
                ]
              },
              {
                "required": [
                  "vars"
                ]
              },
              {
                "required": [
                  "wait"
                ]
              }
            ]
          }
        },
        {
          "required": [
            "artifact_validate"
          ],
          "not": {
            "anyOf": [
              {
                "required": [
                  "assert"
                ]
              },
              {
                "required": [
                  "artifact_capture"
                ]
              },
              {
                "required": [
                  "command"
                ]
              },
              {
                "required": [
                  "copy"
                ]
              },
              {
                "required": [
                  "download"
                ]
              },
              {
                "required": [
                  "file"
                ]
              },
              {
                "required": [
                  "file_delete_range"
                ]
              },
              {
                "required": [
                  "file_insert"
                ]
              },
              {
                "required": [
                  "file_patch_apply"
                ]
              },
              {
                "required": [
                  "file_replace"
                ]
              },
              {
                "required": [
                  "include"
                ]
              },
              {
                "required": [
                  "include_vars"
                ]
              },
              {
                "required": [
                  "package"
                ]
              },
              {
                "required": [
                  "preset"
                ]
              },
              {
                "required": [
                  "print"
                ]
              },
              {
                "required": [
                  "repo_apply_patchset"
                ]
              },
              {
                "required": [
                  "repo_search"
                ]
              },
              {
                "required": [
                  "repo_tree"
                ]
              },
              {
                "required": [
                  "service"
                ]
              },
              {
                "required": [
                  "shell"
                ]
              },
              {
                "required": [
                  "template"
                ]
              },
              {
                "required": [
                  "unarchive"
                ]
              },
              {
                "required": [
                  "vars"
                ]
              },
              {
                "required": [
                  "wait"
                ]
              }
            ]
          }
        }
      ],
      "additionalProperties": false
    },
    "template": {
      "type": "object",
      "description": "Render template files and write to destination",
      "properties": {
        "dest": {
          "type": "string"
        },
        "mode": {
          "type": "string",
          "pattern": "^[0-7]{3,4}$"
        },
        "src": {
          "type": "string"
        },
        "vars": {
          "type": "object",
          "additionalProperties": true
        }
      },
      "required": [
        "src",
        "dest"
      ],
      "additionalProperties": false,
      "x-implements-check": true,
      "x-category": "file",
      "x-supports-dry-run": true,
      "x-supports-become": true,
      "x-version": "1.0.0",
      "x-emits-events": [
        "template.rendered"
      ]
    },
    "unarchive": {
      "type": "object",
      "description": "Extract archive files (tar, tar.gz, zip) with path traversal protection",
      "properties": {
        "creates": {
          "type": "string"
        },
        "dest": {
          "type": "string"
        },
        "mode": {
          "type": "string",
          "pattern": "^[0-7]{3,4}$"
        },
        "src": {
          "type": "string"
        },
        "strip_components": {
          "type": "integer"
        }
      },
      "required": [
        "src",
        "dest"
      ],
      "additionalProperties": false,
      "x-implements-check": true,
      "x-category": "file",
      "x-supports-dry-run": true,
      "x-version": "1.0.0",
      "x-emits-events": [
        "archive.extracted"
      ]
    },
    "vars": {
      "type": "object",
      "description": "Define or update variables",
      "additionalProperties": true,
      "x-category": "data",
      "x-supports-dry-run": true,
      "x-version": "1.0.0",
      "x-emits-events": [
        "variables.set"
      ]
    },
    "wait": {
      "type": "object",
      "description": "Poll a condition until it becomes true or times out",
      "properties": {
        "allow_untracked": {
          "type": "boolean"
        },
        "cmd": {
          "type": "string"
        },
        "condition": {
          "type": "string"
        },
        "exit_code": {
          "type": "integer"
        },
        "host": {
          "type": "string"
        },
        "interval": {
          "type": "string"
        },
        "path": {
          "type": "string"
        },
        "port": {
          "type": "integer"
        },
        "status": {
          "type": "integer"
        },
        "timeout": {
          "type": "string",
          "pattern": "^[0-9]+(ns|us|\u00b5s|ms|s|m|h)$"
        },
        "url": {
          "type": "string"
        }
      },
      "required": [
        "condition"
      ],
      "additionalProperties": false,
      "x-category": "system",
      "x-supports-dry-run": true
    }
  }
}