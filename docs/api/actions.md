<!-- Code generated by gomarkdoc. DO NOT EDIT -->

# actions

```go
import "github.com/alehatsman/mooncake/internal/actions"
```

Package actions provides the action handler system for mooncake.

### Overview

The actions package defines a standard interface \(Handler\) that all action implementations must follow, along with a registry for discovering handlers at runtime.

### Architecture

Actions are implemented as packages under internal/actions/. Each action package provides a Handler implementation that is registered globally on import via an init\(\) function.

The executor looks up handlers from the registry based on the action type determined from the step configuration.

### Backward Compatibility

This new system is designed to work alongside the existing action implementations. The Step struct retains all existing action fields \(Shell, File, Template, etc.\), and actions are migrated incrementally to the new Handler interface.

### Creating a New Action

To create a new action handler:

1. Create a package under internal/actions/ \(e.g., internal/actions/notify\)

2. Implement the Handler interface:

```
type Handler struct{}

func (h *Handler) Metadata() actions.ActionMetadata {
    return actions.ActionMetadata{
        Name:           "notify",
        Description:    "Send notifications",
        Category:       actions.CategorySystem,
        SupportsDryRun: true,
    }
}

func (h *Handler) Validate(step *config.Step) error {
    // Validate step.Notify config
    return nil
}

func (h *Handler) Execute(ctx *executor.ExecutionContext, step *config.Step) (*executor.Result, error) {
    // Implement action logic
    return &executor.Result{Changed: true}, nil
}

func (h *Handler) DryRun(ctx *executor.ExecutionContext, step *config.Step) error {
    ctx.Logger.Infof("  [DRY-RUN] Would send notification")
    return nil
}
```

3. Register the handler in init\(\):

```
func init() {
    actions.Register(&Handler{})
}
```

4. Import the package in the executor to ensure registration:

```
import _ "github.com/alehatsman/mooncake/internal/actions/notify"
```

### Migration Strategy

Existing actions are being migrated incrementally:

- Phase 1: Create Handler implementations for simple actions \(print, vars\)
- Phase 2: Migrate complex actions \(shell, file, template\)
- Phase 3: Migrate specialized actions \(service, assert, preset\)
- Phase 4: Remove legacy code paths

During migration, both old and new implementations coexist. The executor checks if a handler is registered and prefers it, falling back to legacy implementations for non\-migrated actions.

Package actions provides the handler interface and registry for mooncake actions.

The actions package defines a standard interface that all action handlers must implement, along with a registry system for discovering and dispatching to handlers at runtime.

To create a new action handler:

1. Create a new package under internal/actions \(e.g., internal/actions/notify\)
2. Implement the Handler interface
3. Register your handler in an init\(\) function
4. The handler will be automatically available for use

Example:

```
package notify

import "github.com/alehatsman/mooncake/internal/actions"

type Handler struct{}

func init() {
    actions.Register(&Handler{})
}

func (h *Handler) Metadata() actions.ActionMetadata {
    return actions.ActionMetadata{
        Name:        "notify",
        Description: "Send notifications",
        Category:    actions.CategorySystem,
    }
}

// ... implement other interface methods
```

## Index

- [func Count\(\) int](<#Count>)
- [func Has\(actionType string\) bool](<#Has>)
- [func Register\(handler Handler\)](<#Register>)
- [type ActionCategory](<#ActionCategory>)
- [type ActionMetadata](<#ActionMetadata>)
  - [func List\(\) \[\]ActionMetadata](<#List>)
- [type Context](<#Context>)
- [type Handler](<#Handler>)
  - [func Get\(actionType string\) \(Handler, bool\)](<#Get>)
  - [func NewHandlerFunc\(metadata ActionMetadata, validate func\(\*config.Step\) error, execute func\(Context, \*config.Step\) \(Result, error\), dryRun func\(Context, \*config.Step\) error\) Handler](<#NewHandlerFunc>)
- [type HandlerFunc](<#HandlerFunc>)
  - [func \(h \*HandlerFunc\) DryRun\(ctx Context, step \*config.Step\) error](<#HandlerFunc.DryRun>)
  - [func \(h \*HandlerFunc\) Execute\(ctx Context, step \*config.Step\) \(Result, error\)](<#HandlerFunc.Execute>)
  - [func \(h \*HandlerFunc\) Metadata\(\) ActionMetadata](<#HandlerFunc.Metadata>)
  - [func \(h \*HandlerFunc\) Validate\(step \*config.Step\) error](<#HandlerFunc.Validate>)
- [type Registry](<#Registry>)
  - [func NewRegistry\(\) \*Registry](<#NewRegistry>)
  - [func \(r \*Registry\) Count\(\) int](<#Registry.Count>)
  - [func \(r \*Registry\) Get\(actionType string\) \(Handler, bool\)](<#Registry.Get>)
  - [func \(r \*Registry\) Has\(actionType string\) bool](<#Registry.Has>)
  - [func \(r \*Registry\) List\(\) \[\]ActionMetadata](<#Registry.List>)
  - [func \(r \*Registry\) Register\(handler Handler\)](<#Registry.Register>)
- [type Result](<#Result>)


<a name="Count"></a>
## func [Count](<https://github.com/alehatsman/mooncake/blob/master/internal/actions/registry.go#L109>)

```go
func Count() int
```

Count returns the number of handlers in the global registry.

<a name="Has"></a>
## func [Has](<https://github.com/alehatsman/mooncake/blob/master/internal/actions/registry.go#L104>)

```go
func Has(actionType string) bool
```

Has checks if a handler exists in the global registry.

<a name="Register"></a>
## func [Register](<https://github.com/alehatsman/mooncake/blob/master/internal/actions/registry.go#L89>)

```go
func Register(handler Handler)
```

Register registers a handler in the global registry. This is the most common way to register handlers from init\(\) functions.

Example:

```
func init() {
    actions.Register(&MyHandler{})
}
```

<a name="ActionCategory"></a>
## type [ActionCategory](<https://github.com/alehatsman/mooncake/blob/master/internal/actions/handler.go#L40>)

ActionCategory groups related actions by their primary function.

```go
type ActionCategory string
```

<a name="CategoryCommand"></a>

```go
const (
    // CategoryCommand represents actions that execute commands (shell, command)
    CategoryCommand ActionCategory = "command"

    // CategoryFile represents actions that manipulate files (file, template, copy, download)
    CategoryFile ActionCategory = "file"

    // CategorySystem represents system-level actions (service, assert, preset)
    CategorySystem ActionCategory = "system"

    // CategoryData represents data manipulation actions (vars, include_vars)
    CategoryData ActionCategory = "data"

    // CategoryNetwork represents network-related actions (download, http requests)
    CategoryNetwork ActionCategory = "network"

    // CategoryOutput represents output/display actions (print)
    CategoryOutput ActionCategory = "output"
)
```

<a name="ActionMetadata"></a>
## type [ActionMetadata](<https://github.com/alehatsman/mooncake/blob/master/internal/actions/handler.go#L63-L84>)

ActionMetadata describes an action type and its capabilities.

```go
type ActionMetadata struct {
    // Name is the action name as it appears in YAML (e.g., "shell", "file", "notify")
    Name string

    // Description is a human-readable description of what this action does
    Description string

    // Category groups related actions (command, file, system, etc.)
    Category ActionCategory

    // SupportsDryRun indicates whether this action can be executed in dry-run mode
    SupportsDryRun bool

    // SupportsBecome indicates whether this action supports privilege escalation (sudo)
    SupportsBecome bool

    // EmitsEvents lists the event types this action emits (e.g., "file.created", "notify.sent")
    EmitsEvents []string

    // Version is the action implementation version (semantic versioning)
    Version string
}
```

<a name="List"></a>
### func [List](<https://github.com/alehatsman/mooncake/blob/master/internal/actions/registry.go#L99>)

```go
func List() []ActionMetadata
```

List returns all handlers from the global registry.

<a name="Context"></a>
## type [Context](<https://github.com/alehatsman/mooncake/blob/master/internal/actions/interfaces.go#L12-L33>)

Context defines the interface for action execution context. This avoids circular imports with the executor package.

```go
type Context interface {
    // Template provides template rendering
    GetTemplate() template.Renderer

    // Evaluator provides expression evaluation
    GetEvaluator() expression.Evaluator

    // Logger provides logging
    GetLogger() logger.Logger

    // Variables provides access to execution variables
    GetVariables() map[string]interface{}

    // EventPublisher provides event publishing
    GetEventPublisher() events.Publisher

    // DryRun indicates if this is a dry-run execution
    IsDryRun() bool

    // CurrentStepID returns the current step ID
    GetCurrentStepID() string
}
```

<a name="Handler"></a>
## type [Handler](<https://github.com/alehatsman/mooncake/blob/master/internal/actions/handler.go#L96-L129>)

Handler defines the interface that all action handlers must implement.

A handler is responsible for:

- Validating action configuration
- Executing the action
- Handling dry\-run mode
- Emitting appropriate events
- Returning results

Handlers should be stateless \- all execution state is passed via ExecutionContext.

```go
type Handler interface {
    // Metadata returns metadata describing this action type.
    Metadata() ActionMetadata

    // Validate checks if the step configuration is valid for this action.
    // This is called before Execute to fail fast on configuration errors.
    // Returns an error if validation fails.
    Validate(step *config.Step) error

    // Execute runs the action and returns a result.
    // The result includes whether the action made changes, output data,
    // and any error information.
    //
    // Handlers should:
    //   - Emit appropriate events via ctx.GetEventPublisher()
    //   - Handle template rendering via ctx.GetTemplate()
    //   - Use ctx.GetLogger() for logging
    //   - Return a Result with Changed=true if the action modified state
    //
    // If an error occurs, return it - the executor will handle result registration.
    Execute(ctx Context, step *config.Step) (Result, error)

    // DryRun logs what would happen if Execute were called, without making changes.
    // This is called when the executor is in dry-run mode.
    //
    // Handlers should:
    //   - Use ctx.GetLogger() to describe what would happen
    //   - Attempt to render templates (but catch errors gracefully)
    //   - NOT make any actual changes to the system
    //   - NOT emit action-specific events (step lifecycle events are handled by executor)
    //
    // Returns an error only if dry-run simulation fails catastrophically.
    DryRun(ctx Context, step *config.Step) error
}
```

<a name="Get"></a>
### func [Get](<https://github.com/alehatsman/mooncake/blob/master/internal/actions/registry.go#L94>)

```go
func Get(actionType string) (Handler, bool)
```

Get retrieves a handler from the global registry.

<a name="NewHandlerFunc"></a>
### func [NewHandlerFunc](<https://github.com/alehatsman/mooncake/blob/master/internal/actions/handler.go#L141-L146>)

```go
func NewHandlerFunc(metadata ActionMetadata, validate func(*config.Step) error, execute func(Context, *config.Step) (Result, error), dryRun func(Context, *config.Step) error) Handler
```

NewHandlerFunc creates a Handler from function implementations.

<a name="HandlerFunc"></a>
## type [HandlerFunc](<https://github.com/alehatsman/mooncake/blob/master/internal/actions/handler.go#L133-L138>)

HandlerFunc is a function type that implements Handler for simple actions. This allows creating handlers without defining a new type.

```go
type HandlerFunc struct {
    // contains filtered or unexported fields
}
```

<a name="HandlerFunc.DryRun"></a>
### func \(\*HandlerFunc\) [DryRun](<https://github.com/alehatsman/mooncake/blob/master/internal/actions/handler.go#L170>)

```go
func (h *HandlerFunc) DryRun(ctx Context, step *config.Step) error
```



<a name="HandlerFunc.Execute"></a>
### func \(\*HandlerFunc\) [Execute](<https://github.com/alehatsman/mooncake/blob/master/internal/actions/handler.go#L166>)

```go
func (h *HandlerFunc) Execute(ctx Context, step *config.Step) (Result, error)
```



<a name="HandlerFunc.Metadata"></a>
### func \(\*HandlerFunc\) [Metadata](<https://github.com/alehatsman/mooncake/blob/master/internal/actions/handler.go#L155>)

```go
func (h *HandlerFunc) Metadata() ActionMetadata
```



<a name="HandlerFunc.Validate"></a>
### func \(\*HandlerFunc\) [Validate](<https://github.com/alehatsman/mooncake/blob/master/internal/actions/handler.go#L159>)

```go
func (h *HandlerFunc) Validate(step *config.Step) error
```



<a name="Registry"></a>
## type [Registry](<https://github.com/alehatsman/mooncake/blob/master/internal/actions/registry.go#L10-L13>)

Registry manages registered action handlers. It provides thread\-safe registration and lookup of handlers by action type.

```go
type Registry struct {
    // contains filtered or unexported fields
}
```

<a name="NewRegistry"></a>
### func [NewRegistry](<https://github.com/alehatsman/mooncake/blob/master/internal/actions/registry.go#L16>)

```go
func NewRegistry() *Registry
```

NewRegistry creates a new action registry.

<a name="Registry.Count"></a>
### func \(\*Registry\) [Count](<https://github.com/alehatsman/mooncake/blob/master/internal/actions/registry.go#L71>)

```go
func (r *Registry) Count() int
```

Count returns the number of registered handlers.

<a name="Registry.Get"></a>
### func \(\*Registry\) [Get](<https://github.com/alehatsman/mooncake/blob/master/internal/actions/registry.go#L40>)

```go
func (r *Registry) Get(actionType string) (Handler, bool)
```

Get retrieves a handler by action type name. Returns the handler and true if found, nil and false otherwise.

<a name="Registry.Has"></a>
### func \(\*Registry\) [Has](<https://github.com/alehatsman/mooncake/blob/master/internal/actions/registry.go#L62>)

```go
func (r *Registry) Has(actionType string) bool
```

Has checks if a handler is registered for the given action type.

<a name="Registry.List"></a>
### func \(\*Registry\) [List](<https://github.com/alehatsman/mooncake/blob/master/internal/actions/registry.go#L50>)

```go
func (r *Registry) List() []ActionMetadata
```

List returns metadata for all registered handlers. Useful for introspection and documentation generation.

<a name="Registry.Register"></a>
### func \(\*Registry\) [Register](<https://github.com/alehatsman/mooncake/blob/master/internal/actions/registry.go#L25>)

```go
func (r *Registry) Register(handler Handler)
```

Register adds a handler to the registry. This is typically called from init\(\) functions in action packages. Panics if a handler with the same name is already registered.

<a name="Result"></a>
## type [Result](<https://github.com/alehatsman/mooncake/blob/master/internal/actions/interfaces.go#L37-L55>)

Result defines the interface for action results. This avoids circular imports with the executor package.

```go
type Result interface {
    // SetChanged marks whether the action made changes
    SetChanged(changed bool)

    // SetStdout sets the stdout output
    SetStdout(stdout string)

    // SetStderr sets the stderr output
    SetStderr(stderr string)

    // SetFailed marks the result as failed
    SetFailed(failed bool)

    // SetData sets custom result data
    SetData(data map[string]interface{})

    // RegisterTo registers the result to variables
    RegisterTo(variables map[string]interface{}, name string)
}
```

# assert

```go
import "github.com/alehatsman/mooncake/internal/actions/assert"
```

Package assert implements the assert action handler. Assertions verify conditions without changing system state.

## Index

- [type Handler](<#Handler>)
  - [func \(h \*Handler\) DryRun\(ctx actions.Context, step \*config.Step\) error](<#Handler.DryRun>)
  - [func \(h \*Handler\) Execute\(ctx actions.Context, step \*config.Step\) \(actions.Result, error\)](<#Handler.Execute>)
  - [func \(h \*Handler\) Metadata\(\) actions.ActionMetadata](<#Handler.Metadata>)
  - [func \(h \*Handler\) Validate\(step \*config.Step\) error](<#Handler.Validate>)


<a name="Handler"></a>
## type [Handler](<https://github.com/alehatsman/mooncake/blob/master/internal/actions/assert/handler.go#L22>)

Handler implements the assert action handler.

```go
type Handler struct{}
```

<a name="Handler.DryRun"></a>
### func \(\*Handler\) [DryRun](<https://github.com/alehatsman/mooncake/blob/master/internal/actions/assert/handler.go#L117>)

```go
func (h *Handler) DryRun(ctx actions.Context, step *config.Step) error
```

DryRun logs what the assertion would check.

<a name="Handler.Execute"></a>
### func \(\*Handler\) [Execute](<https://github.com/alehatsman/mooncake/blob/master/internal/actions/assert/handler.go#L67>)

```go
func (h *Handler) Execute(ctx actions.Context, step *config.Step) (actions.Result, error)
```

Execute executes the assert action.

<a name="Handler.Metadata"></a>
### func \(\*Handler\) [Metadata](<https://github.com/alehatsman/mooncake/blob/master/internal/actions/assert/handler.go#L29>)

```go
func (h *Handler) Metadata() actions.ActionMetadata
```

Metadata returns the action metadata.

<a name="Handler.Validate"></a>
### func \(\*Handler\) [Validate](<https://github.com/alehatsman/mooncake/blob/master/internal/actions/assert/handler.go#L39>)

```go
func (h *Handler) Validate(step *config.Step) error
```

Validate validates the assert action configuration.

# command

```go
import "github.com/alehatsman/mooncake/internal/actions/command"
```

Package command implements the command action handler.

The command action executes commands directly without shell interpolation. This is safer than shell when you have a known command with arguments, as it prevents shell injection attacks.

## Index

- [type Handler](<#Handler>)
  - [func \(h \*Handler\) DryRun\(ctx actions.Context, step \*config.Step\) error](<#Handler.DryRun>)
  - [func \(h \*Handler\) Execute\(ctx actions.Context, step \*config.Step\) \(actions.Result, error\)](<#Handler.Execute>)
  - [func \(Handler\) Metadata\(\) actions.ActionMetadata](<#Handler.Metadata>)
  - [func \(h \*Handler\) Validate\(step \*config.Step\) error](<#Handler.Validate>)


<a name="Handler"></a>
## type [Handler](<https://github.com/alehatsman/mooncake/blob/master/internal/actions/command/handler.go#L24>)

Handler implements the Handler interface for command actions.

```go
type Handler struct{}
```

<a name="Handler.DryRun"></a>
### func \(\*Handler\) [DryRun](<https://github.com/alehatsman/mooncake/blob/master/internal/actions/command/handler.go#L315>)

```go
func (h *Handler) DryRun(ctx actions.Context, step *config.Step) error
```

DryRun logs what would be executed without actually running the command.

<a name="Handler.Execute"></a>
### func \(\*Handler\) [Execute](<https://github.com/alehatsman/mooncake/blob/master/internal/actions/command/handler.go#L58>)

```go
func (h *Handler) Execute(ctx actions.Context, step *config.Step) (actions.Result, error)
```

Execute runs the command action with retry logic if configured.

<a name="Handler.Metadata"></a>
### func \(Handler\) [Metadata](<https://github.com/alehatsman/mooncake/blob/master/internal/actions/command/handler.go#L32>)

```go
func (Handler) Metadata() actions.ActionMetadata
```

Metadata returns metadata about the command action.

<a name="Handler.Validate"></a>
### func \(\*Handler\) [Validate](<https://github.com/alehatsman/mooncake/blob/master/internal/actions/command/handler.go#L45>)

```go
func (h *Handler) Validate(step *config.Step) error
```

Validate checks if the command configuration is valid.

# copy

```go
import "github.com/alehatsman/mooncake/internal/actions/copy"
```

Package copy implements the copy action handler.

The copy action copies files from source to destination with: \- Checksum verification \(before and after copy\) \- Atomic write pattern \(temp file \+ rename\) \- Backup support \- Idempotency based on size/modtime

## Index

- [type Handler](<#Handler>)
  - [func \(h \*Handler\) DryRun\(ctx actions.Context, step \*config.Step\) error](<#Handler.DryRun>)
  - [func \(h \*Handler\) Execute\(ctx actions.Context, step \*config.Step\) \(actions.Result, error\)](<#Handler.Execute>)
  - [func \(Handler\) Metadata\(\) actions.ActionMetadata](<#Handler.Metadata>)
  - [func \(h \*Handler\) Validate\(step \*config.Step\) error](<#Handler.Validate>)


<a name="Handler"></a>
## type [Handler](<https://github.com/alehatsman/mooncake/blob/master/internal/actions/copy/handler.go#L30>)

Handler implements the Handler interface for copy actions.

```go
type Handler struct{}
```

<a name="Handler.DryRun"></a>
### func \(\*Handler\) [DryRun](<https://github.com/alehatsman/mooncake/blob/master/internal/actions/copy/handler.go#L210>)

```go
func (h *Handler) DryRun(ctx actions.Context, step *config.Step) error
```

DryRun logs what would be done without actually doing it.

<a name="Handler.Execute"></a>
### func \(\*Handler\) [Execute](<https://github.com/alehatsman/mooncake/blob/master/internal/actions/copy/handler.go#L69>)

```go
func (h *Handler) Execute(ctx actions.Context, step *config.Step) (actions.Result, error)
```

Execute runs the copy action.

<a name="Handler.Metadata"></a>
### func \(Handler\) [Metadata](<https://github.com/alehatsman/mooncake/blob/master/internal/actions/copy/handler.go#L38>)

```go
func (Handler) Metadata() actions.ActionMetadata
```

Metadata returns metadata about the copy action.

<a name="Handler.Validate"></a>
### func \(\*Handler\) [Validate](<https://github.com/alehatsman/mooncake/blob/master/internal/actions/copy/handler.go#L51>)

```go
func (h *Handler) Validate(step *config.Step) error
```

Validate checks if the copy configuration is valid.

# download

```go
import "github.com/alehatsman/mooncake/internal/actions/download"
```

Package download implements the download action handler.

The download action downloads files from URLs with: \- HTTP/HTTPS support \- Checksum verification \(MD5, SHA1, SHA256\) for idempotency \- Custom HTTP headers \- Timeout and retry support \- Atomic write pattern \(temp file \+ rename\)

## Index

- [type Handler](<#Handler>)
  - [func \(h \*Handler\) DryRun\(ctx actions.Context, step \*config.Step\) error](<#Handler.DryRun>)
  - [func \(h \*Handler\) Execute\(ctx actions.Context, step \*config.Step\) \(actions.Result, error\)](<#Handler.Execute>)
  - [func \(Handler\) Metadata\(\) actions.ActionMetadata](<#Handler.Metadata>)
  - [func \(h \*Handler\) Validate\(step \*config.Step\) error](<#Handler.Validate>)


<a name="Handler"></a>
## type [Handler](<https://github.com/alehatsman/mooncake/blob/master/internal/actions/download/handler.go#L35>)

Handler implements the Handler interface for download actions.

```go
type Handler struct{}
```

<a name="Handler.DryRun"></a>
### func \(\*Handler\) [DryRun](<https://github.com/alehatsman/mooncake/blob/master/internal/actions/download/handler.go#L220>)

```go
func (h *Handler) DryRun(ctx actions.Context, step *config.Step) error
```

DryRun logs what would be done without actually doing it.

<a name="Handler.Execute"></a>
### func \(\*Handler\) [Execute](<https://github.com/alehatsman/mooncake/blob/master/internal/actions/download/handler.go#L74>)

```go
func (h *Handler) Execute(ctx actions.Context, step *config.Step) (actions.Result, error)
```

Execute runs the download action.

<a name="Handler.Metadata"></a>
### func \(Handler\) [Metadata](<https://github.com/alehatsman/mooncake/blob/master/internal/actions/download/handler.go#L43>)

```go
func (Handler) Metadata() actions.ActionMetadata
```

Metadata returns metadata about the download action.

<a name="Handler.Validate"></a>
### func \(\*Handler\) [Validate](<https://github.com/alehatsman/mooncake/blob/master/internal/actions/download/handler.go#L56>)

```go
func (h *Handler) Validate(step *config.Step) error
```

Validate checks if the download configuration is valid.

# file

```go
import "github.com/alehatsman/mooncake/internal/actions/file"
```

Package file implements the file action handler.

The file action manages files, directories, and links with support for: \- Creating/updating files with content \- Creating directories \- Removing files and directories \- Creating symbolic and hard links \- Setting permissions and ownership \- Touch operations \(update timestamps\)

## Index

- [type Handler](<#Handler>)
  - [func \(h \*Handler\) DryRun\(ctx actions.Context, step \*config.Step\) error](<#Handler.DryRun>)
  - [func \(h \*Handler\) Execute\(ctx actions.Context, step \*config.Step\) \(actions.Result, error\)](<#Handler.Execute>)
  - [func \(Handler\) Metadata\(\) actions.ActionMetadata](<#Handler.Metadata>)
  - [func \(h \*Handler\) Validate\(step \*config.Step\) error](<#Handler.Validate>)


<a name="Handler"></a>
## type [Handler](<https://github.com/alehatsman/mooncake/blob/master/internal/actions/file/handler.go#L36>)

Handler implements the Handler interface for file actions.

```go
type Handler struct{}
```

<a name="Handler.DryRun"></a>
### func \(\*Handler\) [DryRun](<https://github.com/alehatsman/mooncake/blob/master/internal/actions/file/handler.go#L152>)

```go
func (h *Handler) DryRun(ctx actions.Context, step *config.Step) error
```

DryRun logs what would be done without actually doing it.

<a name="Handler.Execute"></a>
### func \(\*Handler\) [Execute](<https://github.com/alehatsman/mooncake/blob/master/internal/actions/file/handler.go#L93>)

```go
func (h *Handler) Execute(ctx actions.Context, step *config.Step) (actions.Result, error)
```

Execute runs the file action.

<a name="Handler.Metadata"></a>
### func \(Handler\) [Metadata](<https://github.com/alehatsman/mooncake/blob/master/internal/actions/file/handler.go#L44>)

```go
func (Handler) Metadata() actions.ActionMetadata
```

Metadata returns metadata about the file action.

<a name="Handler.Validate"></a>
### func \(\*Handler\) [Validate](<https://github.com/alehatsman/mooncake/blob/master/internal/actions/file/handler.go#L65>)

```go
func (h *Handler) Validate(step *config.Step) error
```

Validate checks if the file configuration is valid.

# include\_vars

```go
import "github.com/alehatsman/mooncake/internal/actions/include_vars"
```

Package include\_vars implements the include\_vars action handler.

The include\_vars action loads variables from YAML files into the execution context. This is useful for organizing variables across multiple files.

## Index

- [type Handler](<#Handler>)
  - [func \(h \*Handler\) DryRun\(ctx actions.Context, step \*config.Step\) error](<#Handler.DryRun>)
  - [func \(h \*Handler\) Execute\(ctx actions.Context, step \*config.Step\) \(actions.Result, error\)](<#Handler.Execute>)
  - [func \(Handler\) Metadata\(\) actions.ActionMetadata](<#Handler.Metadata>)
  - [func \(h \*Handler\) Validate\(step \*config.Step\) error](<#Handler.Validate>)


<a name="Handler"></a>
## type [Handler](<https://github.com/alehatsman/mooncake/blob/master/internal/actions/include_vars/handler.go#L18>)

Handler implements the Handler interface for include\_vars actions.

```go
type Handler struct{}
```

<a name="Handler.DryRun"></a>
### func \(\*Handler\) [DryRun](<https://github.com/alehatsman/mooncake/blob/master/internal/actions/include_vars/handler.go#L108>)

```go
func (h *Handler) DryRun(ctx actions.Context, step *config.Step) error
```

DryRun logs what variables would be loaded.

<a name="Handler.Execute"></a>
### func \(\*Handler\) [Execute](<https://github.com/alehatsman/mooncake/blob/master/internal/actions/include_vars/handler.go#L52>)

```go
func (h *Handler) Execute(ctx actions.Context, step *config.Step) (actions.Result, error)
```

Execute runs the include\_vars action.

<a name="Handler.Metadata"></a>
### func \(Handler\) [Metadata](<https://github.com/alehatsman/mooncake/blob/master/internal/actions/include_vars/handler.go#L26>)

```go
func (Handler) Metadata() actions.ActionMetadata
```

Metadata returns metadata about the include\_vars action.

<a name="Handler.Validate"></a>
### func \(\*Handler\) [Validate](<https://github.com/alehatsman/mooncake/blob/master/internal/actions/include_vars/handler.go#L39>)

```go
func (h *Handler) Validate(step *config.Step) error
```

Validate checks if the include\_vars configuration is valid.

# package\_handler

```go
import "github.com/alehatsman/mooncake/internal/actions/package"
```

Package package implements the package action handler.

The package action manages system packages with support for: \- Auto\-detection of package manager \(apt, dnf, yum, pacman, zypper, apk, brew, port, choco, scoop\) \- Manual package manager selection \- Install, remove, and update operations \- Cache management and system upgrades

## Index

- [type Handler](<#Handler>)
  - [func \(h \*Handler\) DryRun\(ctx actions.Context, step \*config.Step\) error](<#Handler.DryRun>)
  - [func \(h \*Handler\) Execute\(ctx actions.Context, step \*config.Step\) \(actions.Result, error\)](<#Handler.Execute>)
  - [func \(h \*Handler\) Metadata\(\) actions.ActionMetadata](<#Handler.Metadata>)
  - [func \(h \*Handler\) Validate\(step \*config.Step\) error](<#Handler.Validate>)


<a name="Handler"></a>
## type [Handler](<https://github.com/alehatsman/mooncake/blob/master/internal/actions/package/handler.go#L23>)

Handler implements the Handler interface for package actions.

```go
type Handler struct{}
```

<a name="Handler.DryRun"></a>
### func \(\*Handler\) [DryRun](<https://github.com/alehatsman/mooncake/blob/master/internal/actions/package/handler.go#L119>)

```go
func (h *Handler) DryRun(ctx actions.Context, step *config.Step) error
```

DryRun shows what would be done without making changes.

<a name="Handler.Execute"></a>
### func \(\*Handler\) [Execute](<https://github.com/alehatsman/mooncake/blob/master/internal/actions/package/handler.go#L65>)

```go
func (h *Handler) Execute(ctx actions.Context, step *config.Step) (actions.Result, error)
```

Execute runs the package action.

<a name="Handler.Metadata"></a>
### func \(\*Handler\) [Metadata](<https://github.com/alehatsman/mooncake/blob/master/internal/actions/package/handler.go#L31>)

```go
func (h *Handler) Metadata() actions.ActionMetadata
```

Metadata returns metadata about the package action.

<a name="Handler.Validate"></a>
### func \(\*Handler\) [Validate](<https://github.com/alehatsman/mooncake/blob/master/internal/actions/package/handler.go#L44>)

```go
func (h *Handler) Validate(step *config.Step) error
```

Validate checks if the package configuration is valid.

# preset

```go
import "github.com/alehatsman/mooncake/internal/actions/preset"
```

Package preset implements the preset action handler. Presets expand into multiple steps with parameter injection.

## Index

- [type Handler](<#Handler>)
  - [func \(h \*Handler\) DryRun\(ctx actions.Context, step \*config.Step\) error](<#Handler.DryRun>)
  - [func \(h \*Handler\) Execute\(ctx actions.Context, step \*config.Step\) \(actions.Result, error\)](<#Handler.Execute>)
  - [func \(h \*Handler\) Metadata\(\) actions.ActionMetadata](<#Handler.Metadata>)
  - [func \(h \*Handler\) Validate\(step \*config.Step\) error](<#Handler.Validate>)


<a name="Handler"></a>
## type [Handler](<https://github.com/alehatsman/mooncake/blob/master/internal/actions/preset/handler.go#L17>)

Handler implements the preset action handler.

```go
type Handler struct{}
```

<a name="Handler.DryRun"></a>
### func \(\*Handler\) [DryRun](<https://github.com/alehatsman/mooncake/blob/master/internal/actions/preset/handler.go#L160>)

```go
func (h *Handler) DryRun(ctx actions.Context, step *config.Step) error
```

DryRun logs what the preset would expand.

<a name="Handler.Execute"></a>
### func \(\*Handler\) [Execute](<https://github.com/alehatsman/mooncake/blob/master/internal/actions/preset/handler.go#L79>)

```go
func (h *Handler) Execute(ctx actions.Context, step *config.Step) (actions.Result, error)
```

Execute executes the preset action.

<a name="Handler.Metadata"></a>
### func \(\*Handler\) [Metadata](<https://github.com/alehatsman/mooncake/blob/master/internal/actions/preset/handler.go#L58>)

```go
func (h *Handler) Metadata() actions.ActionMetadata
```

Metadata returns the action metadata.

<a name="Handler.Validate"></a>
### func \(\*Handler\) [Validate](<https://github.com/alehatsman/mooncake/blob/master/internal/actions/preset/handler.go#L68>)

```go
func (h *Handler) Validate(step *config.Step) error
```

Validate validates the preset action configuration.

# print

```go
import "github.com/alehatsman/mooncake/internal/actions/print"
```

Package print implements the print action handler.

The print action displays messages to the user during execution. It supports template rendering and is useful for debugging and showing information.

## Index

- [type Handler](<#Handler>)
  - [func \(h \*Handler\) DryRun\(ctx actions.Context, step \*config.Step\) error](<#Handler.DryRun>)
  - [func \(h \*Handler\) Execute\(ctx actions.Context, step \*config.Step\) \(actions.Result, error\)](<#Handler.Execute>)
  - [func \(h \*Handler\) Metadata\(\) actions.ActionMetadata](<#Handler.Metadata>)
  - [func \(h \*Handler\) Validate\(step \*config.Step\) error](<#Handler.Validate>)


<a name="Handler"></a>
## type [Handler](<https://github.com/alehatsman/mooncake/blob/master/internal/actions/print/handler.go#L18>)

Handler implements the Handler interface for print actions.

```go
type Handler struct{}
```

<a name="Handler.DryRun"></a>
### func \(\*Handler\) [DryRun](<https://github.com/alehatsman/mooncake/blob/master/internal/actions/print/handler.go#L86>)

```go
func (h *Handler) DryRun(ctx actions.Context, step *config.Step) error
```

DryRun logs what would be printed without actually printing.

<a name="Handler.Execute"></a>
### func \(\*Handler\) [Execute](<https://github.com/alehatsman/mooncake/blob/master/internal/actions/print/handler.go#L52>)

```go
func (h *Handler) Execute(ctx actions.Context, step *config.Step) (actions.Result, error)
```

Execute runs the print action.

<a name="Handler.Metadata"></a>
### func \(\*Handler\) [Metadata](<https://github.com/alehatsman/mooncake/blob/master/internal/actions/print/handler.go#L26>)

```go
func (h *Handler) Metadata() actions.ActionMetadata
```

Metadata returns metadata about the print action.

<a name="Handler.Validate"></a>
### func \(\*Handler\) [Validate](<https://github.com/alehatsman/mooncake/blob/master/internal/actions/print/handler.go#L39>)

```go
func (h *Handler) Validate(step *config.Step) error
```

Validate checks if the print configuration is valid.

# service

```go
import "github.com/alehatsman/mooncake/internal/actions/service"
```

Package service implements the service action handler. Manages services across different platforms \(systemd, launchd, Windows\).

## Index

- [Constants](<#constants>)
- [func HandleService\(step config.Step, ec \*executor.ExecutionContext\) error](<#HandleService>)
- [type Handler](<#Handler>)
  - [func \(h \*Handler\) DryRun\(ctx actions.Context, step \*config.Step\) error](<#Handler.DryRun>)
  - [func \(h \*Handler\) Execute\(ctx actions.Context, step \*config.Step\) \(actions.Result, error\)](<#Handler.Execute>)
  - [func \(h \*Handler\) Metadata\(\) actions.ActionMetadata](<#Handler.Metadata>)
  - [func \(h \*Handler\) Validate\(step \*config.Step\) error](<#Handler.Validate>)


## Constants

<a name="ServiceStateStarted"></a>Valid service states

```go
const (
    ServiceStateStarted   = "started"
    ServiceStateStopped   = "stopped"
    ServiceStateReloaded  = "reloaded"
    ServiceStateRestarted = "restarted"
)
```

<a name="HandleService"></a>
## func [HandleService](<https://github.com/alehatsman/mooncake/blob/master/internal/actions/service/handler.go#L129>)

```go
func HandleService(step config.Step, ec *executor.ExecutionContext) error
```

HandleService manages services across different platforms \(systemd, launchd, Windows\).

<a name="Handler"></a>
## type [Handler](<https://github.com/alehatsman/mooncake/blob/master/internal/actions/service/handler.go#L32>)

Handler implements the service action handler.

```go
type Handler struct{}
```

<a name="Handler.DryRun"></a>
### func \(\*Handler\) [DryRun](<https://github.com/alehatsman/mooncake/blob/master/internal/actions/service/handler.go#L90>)

```go
func (h *Handler) DryRun(ctx actions.Context, step *config.Step) error
```

DryRun logs what the service operation would do.

<a name="Handler.Execute"></a>
### func \(\*Handler\) [Execute](<https://github.com/alehatsman/mooncake/blob/master/internal/actions/service/handler.go#L80>)

```go
func (h *Handler) Execute(ctx actions.Context, step *config.Step) (actions.Result, error)
```

Execute executes the service action.

<a name="Handler.Metadata"></a>
### func \(\*Handler\) [Metadata](<https://github.com/alehatsman/mooncake/blob/master/internal/actions/service/handler.go#L39>)

```go
func (h *Handler) Metadata() actions.ActionMetadata
```

Metadata returns the action metadata.

<a name="Handler.Validate"></a>
### func \(\*Handler\) [Validate](<https://github.com/alehatsman/mooncake/blob/master/internal/actions/service/handler.go#L49>)

```go
func (h *Handler) Validate(step *config.Step) error
```

Validate validates the service action configuration.

# shell

```go
import "github.com/alehatsman/mooncake/internal/actions/shell"
```

Package shell implements the shell action handler.

The shell action executes shell commands with support for: \- Multiple interpreters \(bash, sh, pwsh, cmd\) \- Sudo/become privilege escalation \- Environment variables and working directory \- Timeout and retry logic \- Stdin, stdout, stderr handling \- Result overrides \(changed\_when, failed\_when\)

## Index

- [type Handler](<#Handler>)
  - [func \(h \*Handler\) DryRun\(ctx actions.Context, step \*config.Step\) error](<#Handler.DryRun>)
  - [func \(h \*Handler\) Execute\(ctx actions.Context, step \*config.Step\) \(actions.Result, error\)](<#Handler.Execute>)
  - [func \(h \*Handler\) Metadata\(\) actions.ActionMetadata](<#Handler.Metadata>)
  - [func \(h \*Handler\) Validate\(step \*config.Step\) error](<#Handler.Validate>)


<a name="Handler"></a>
## type [Handler](<https://github.com/alehatsman/mooncake/blob/master/internal/actions/shell/handler.go#L33>)

Handler implements the Handler interface for shell actions.

```go
type Handler struct{}
```

<a name="Handler.DryRun"></a>
### func \(\*Handler\) [DryRun](<https://github.com/alehatsman/mooncake/blob/master/internal/actions/shell/handler.go#L102>)

```go
func (h *Handler) DryRun(ctx actions.Context, step *config.Step) error
```

DryRun logs what would be executed.

<a name="Handler.Execute"></a>
### func \(\*Handler\) [Execute](<https://github.com/alehatsman/mooncake/blob/master/internal/actions/shell/handler.go#L85>)

```go
func (h *Handler) Execute(ctx actions.Context, step *config.Step) (actions.Result, error)
```

Execute runs the shell action.

<a name="Handler.Metadata"></a>
### func \(\*Handler\) [Metadata](<https://github.com/alehatsman/mooncake/blob/master/internal/actions/shell/handler.go#L41>)

```go
func (h *Handler) Metadata() actions.ActionMetadata
```

Metadata returns metadata about the shell action.

<a name="Handler.Validate"></a>
### func \(\*Handler\) [Validate](<https://github.com/alehatsman/mooncake/blob/master/internal/actions/shell/handler.go#L57>)

```go
func (h *Handler) Validate(step *config.Step) error
```

Validate checks if the shell configuration is valid.

# template

```go
import "github.com/alehatsman/mooncake/internal/actions/template"
```

Package template implements the template action handler.

The template action reads a template file, renders it with variables, and writes the rendered output to a destination file.

## Index

- [type Handler](<#Handler>)
  - [func \(h \*Handler\) DryRun\(ctx actions.Context, step \*config.Step\) error](<#Handler.DryRun>)
  - [func \(h \*Handler\) Execute\(ctx actions.Context, step \*config.Step\) \(actions.Result, error\)](<#Handler.Execute>)
  - [func \(Handler\) Metadata\(\) actions.ActionMetadata](<#Handler.Metadata>)
  - [func \(h \*Handler\) Validate\(step \*config.Step\) error](<#Handler.Validate>)


<a name="Handler"></a>
## type [Handler](<https://github.com/alehatsman/mooncake/blob/master/internal/actions/template/handler.go#L28>)

Handler implements the Handler interface for template actions.

```go
type Handler struct{}
```

<a name="Handler.DryRun"></a>
### func \(\*Handler\) [DryRun](<https://github.com/alehatsman/mooncake/blob/master/internal/actions/template/handler.go#L168>)

```go
func (h *Handler) DryRun(ctx actions.Context, step *config.Step) error
```

DryRun logs what would be done without actually doing it.

<a name="Handler.Execute"></a>
### func \(\*Handler\) [Execute](<https://github.com/alehatsman/mooncake/blob/master/internal/actions/template/handler.go#L67>)

```go
func (h *Handler) Execute(ctx actions.Context, step *config.Step) (actions.Result, error)
```

Execute runs the template action.

<a name="Handler.Metadata"></a>
### func \(Handler\) [Metadata](<https://github.com/alehatsman/mooncake/blob/master/internal/actions/template/handler.go#L36>)

```go
func (Handler) Metadata() actions.ActionMetadata
```

Metadata returns metadata about the template action.

<a name="Handler.Validate"></a>
### func \(\*Handler\) [Validate](<https://github.com/alehatsman/mooncake/blob/master/internal/actions/template/handler.go#L49>)

```go
func (h *Handler) Validate(step *config.Step) error
```

Validate checks if the template configuration is valid.

# unarchive

```go
import "github.com/alehatsman/mooncake/internal/actions/unarchive"
```

Package unarchive implements the unarchive action handler.

The unarchive action extracts archive files with: \- Format support: tar, tar.gz, tar.bz2, zip \- Strip leading path components \- Idempotency via creates marker \- Path traversal protection \- Extraction statistics

## Index

- [type ArchiveFormat](<#ArchiveFormat>)
  - [func \(f ArchiveFormat\) String\(\) string](<#ArchiveFormat.String>)
- [type ExtractionStats](<#ExtractionStats>)
- [type Handler](<#Handler>)
  - [func \(h \*Handler\) DryRun\(ctx actions.Context, step \*config.Step\) error](<#Handler.DryRun>)
  - [func \(h \*Handler\) Execute\(ctx actions.Context, step \*config.Step\) \(actions.Result, error\)](<#Handler.Execute>)
  - [func \(Handler\) Metadata\(\) actions.ActionMetadata](<#Handler.Metadata>)
  - [func \(h \*Handler\) Validate\(step \*config.Step\) error](<#Handler.Validate>)


<a name="ArchiveFormat"></a>
## type [ArchiveFormat](<https://github.com/alehatsman/mooncake/blob/master/internal/actions/unarchive/handler.go#L36>)

ArchiveFormat represents the type of archive being extracted.

```go
type ArchiveFormat int
```

<a name="ArchiveUnknown"></a>

```go
const (
    ArchiveUnknown ArchiveFormat = iota
    ArchiveTar
    ArchiveTarGz
    ArchiveZip
)
```

<a name="ArchiveFormat.String"></a>
### func \(ArchiveFormat\) [String](<https://github.com/alehatsman/mooncake/blob/master/internal/actions/unarchive/handler.go#L46>)

```go
func (f ArchiveFormat) String() string
```

String returns the string representation of the archive format.

<a name="ExtractionStats"></a>
## type [ExtractionStats](<https://github.com/alehatsman/mooncake/blob/master/internal/actions/unarchive/handler.go#L60-L64>)

ExtractionStats tracks statistics from archive extraction.

```go
type ExtractionStats struct {
    FilesExtracted int
    DirsCreated    int
    BytesExtracted int64
}
```

<a name="Handler"></a>
## type [Handler](<https://github.com/alehatsman/mooncake/blob/master/internal/actions/unarchive/handler.go#L67>)

Handler implements the Handler interface for unarchive actions.

```go
type Handler struct{}
```

<a name="Handler.DryRun"></a>
### func \(\*Handler\) [DryRun](<https://github.com/alehatsman/mooncake/blob/master/internal/actions/unarchive/handler.go#L226>)

```go
func (h *Handler) DryRun(ctx actions.Context, step *config.Step) error
```

DryRun logs what would be done without actually doing it.

<a name="Handler.Execute"></a>
### func \(\*Handler\) [Execute](<https://github.com/alehatsman/mooncake/blob/master/internal/actions/unarchive/handler.go#L106>)

```go
func (h *Handler) Execute(ctx actions.Context, step *config.Step) (actions.Result, error)
```

Execute runs the unarchive action.

<a name="Handler.Metadata"></a>
### func \(Handler\) [Metadata](<https://github.com/alehatsman/mooncake/blob/master/internal/actions/unarchive/handler.go#L75>)

```go
func (Handler) Metadata() actions.ActionMetadata
```

Metadata returns metadata about the unarchive action.

<a name="Handler.Validate"></a>
### func \(\*Handler\) [Validate](<https://github.com/alehatsman/mooncake/blob/master/internal/actions/unarchive/handler.go#L88>)

```go
func (h *Handler) Validate(step *config.Step) error
```

Validate checks if the unarchive configuration is valid.

# vars

```go
import "github.com/alehatsman/mooncake/internal/actions/vars"
```

Package vars implements the vars action handler.

The vars action sets variables that are available to subsequent steps. Variables can be used in templates and when conditions.

## Index

- [type Handler](<#Handler>)
  - [func \(h \*Handler\) DryRun\(ctx actions.Context, step \*config.Step\) error](<#Handler.DryRun>)
  - [func \(h \*Handler\) Execute\(ctx actions.Context, step \*config.Step\) \(actions.Result, error\)](<#Handler.Execute>)
  - [func \(h \*Handler\) Metadata\(\) actions.ActionMetadata](<#Handler.Metadata>)
  - [func \(h \*Handler\) Validate\(step \*config.Step\) error](<#Handler.Validate>)


<a name="Handler"></a>
## type [Handler](<https://github.com/alehatsman/mooncake/blob/master/internal/actions/vars/handler.go#L18>)

Handler implements the Handler interface for vars actions.

```go
type Handler struct{}
```

<a name="Handler.DryRun"></a>
### func \(\*Handler\) [DryRun](<https://github.com/alehatsman/mooncake/blob/master/internal/actions/vars/handler.go#L99>)

```go
func (h *Handler) DryRun(ctx actions.Context, step *config.Step) error
```

DryRun logs what variables would be set.

<a name="Handler.Execute"></a>
### func \(\*Handler\) [Execute](<https://github.com/alehatsman/mooncake/blob/master/internal/actions/vars/handler.go#L48>)

```go
func (h *Handler) Execute(ctx actions.Context, step *config.Step) (actions.Result, error)
```

Execute runs the vars action.

<a name="Handler.Metadata"></a>
### func \(\*Handler\) [Metadata](<https://github.com/alehatsman/mooncake/blob/master/internal/actions/vars/handler.go#L26>)

```go
func (h *Handler) Metadata() actions.ActionMetadata
```

Metadata returns metadata about the vars action.

<a name="Handler.Validate"></a>
### func \(\*Handler\) [Validate](<https://github.com/alehatsman/mooncake/blob/master/internal/actions/vars/handler.go#L39>)

```go
func (h *Handler) Validate(step *config.Step) error
```

Validate checks if the vars configuration is valid.

Generated by [gomarkdoc](<https://github.com/princjef/gomarkdoc>)
