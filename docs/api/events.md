<!-- Code generated by gomarkdoc. DO NOT EDIT -->

# events

```go
import "github.com/alehatsman/mooncake/internal/events"
```

Package events provides the event system for Mooncake execution lifecycle. Events are emitted during execution and consumed by subscribers for logging, artifacts, and observability.

## Index

- [type ArchiveExtractedData](<#ArchiveExtractedData>)
- [type AssertionData](<#AssertionData>)
- [type ChannelPublisher](<#ChannelPublisher>)
  - [func \(p \*ChannelPublisher\) Close\(\)](<#ChannelPublisher.Close>)
  - [func \(p \*ChannelPublisher\) Flush\(\)](<#ChannelPublisher.Flush>)
  - [func \(p \*ChannelPublisher\) Publish\(event Event\)](<#ChannelPublisher.Publish>)
  - [func \(p \*ChannelPublisher\) Subscribe\(subscriber Subscriber\) int](<#ChannelPublisher.Subscribe>)
  - [func \(p \*ChannelPublisher\) Unsubscribe\(id int\)](<#ChannelPublisher.Unsubscribe>)
- [type Event](<#Event>)
- [type EventType](<#EventType>)
- [type FileCopiedData](<#FileCopiedData>)
- [type FileDownloadedData](<#FileDownloadedData>)
- [type FileOperationData](<#FileOperationData>)
- [type FileRemovedData](<#FileRemovedData>)
- [type LinkCreatedData](<#LinkCreatedData>)
- [type PermissionsChangedData](<#PermissionsChangedData>)
- [type PlanLoadedData](<#PlanLoadedData>)
- [type PresetData](<#PresetData>)
- [type PrintData](<#PrintData>)
- [type Publisher](<#Publisher>)
  - [func NewPublisher\(\) Publisher](<#NewPublisher>)
  - [func NewSyncPublisher\(\) Publisher](<#NewSyncPublisher>)
- [type RunCompletedData](<#RunCompletedData>)
- [type RunStartedData](<#RunStartedData>)
- [type ServiceManagementData](<#ServiceManagementData>)
- [type StepCompletedData](<#StepCompletedData>)
- [type StepFailedData](<#StepFailedData>)
- [type StepOutputData](<#StepOutputData>)
- [type StepSkippedData](<#StepSkippedData>)
- [type StepStartedData](<#StepStartedData>)
- [type Subscriber](<#Subscriber>)
- [type SyncPublisher](<#SyncPublisher>)
  - [func \(p \*SyncPublisher\) Close\(\)](<#SyncPublisher.Close>)
  - [func \(p \*SyncPublisher\) Flush\(\)](<#SyncPublisher.Flush>)
  - [func \(p \*SyncPublisher\) Publish\(event Event\)](<#SyncPublisher.Publish>)
  - [func \(p \*SyncPublisher\) Subscribe\(subscriber Subscriber\) int](<#SyncPublisher.Subscribe>)
  - [func \(p \*SyncPublisher\) Unsubscribe\(id int\)](<#SyncPublisher.Unsubscribe>)
- [type TemplateRenderData](<#TemplateRenderData>)
- [type VarsLoadedData](<#VarsLoadedData>)
- [type VarsSetData](<#VarsSetData>)


<a name="ArchiveExtractedData"></a>
## type [ArchiveExtractedData](<https://github.com/alehatsman/mooncake/blob/master/internal/events/event.go#L251-L261>)

ArchiveExtractedData contains data for archive.extracted events

```go
type ArchiveExtractedData struct {
    Src             string `json:"src"`
    Dest            string `json:"dest"`
    Format          string `json:"format"`
    FilesExtracted  int    `json:"files_extracted"`
    DirsCreated     int    `json:"dirs_created"`
    BytesExtracted  int64  `json:"bytes_extracted"`
    StripComponents int    `json:"strip_components,omitempty"`
    DurationMs      int64  `json:"duration_ms"`
    DryRun          bool   `json:"dry_run"`
}
```

<a name="AssertionData"></a>
## type [AssertionData](<https://github.com/alehatsman/mooncake/blob/master/internal/events/event.go#L274-L280>)

AssertionData contains data for assert.passed and assert.failed events

```go
type AssertionData struct {
    Type     string `json:"type"`              // Assertion type: "command", "file", or "http"
    Expected string `json:"expected"`          // What was expected
    Actual   string `json:"actual"`            // What was found
    Failed   bool   `json:"failed"`            // Whether the assertion failed
    StepID   string `json:"step_id,omitempty"` // Step ID (added by event bus)
}
```

<a name="ChannelPublisher"></a>
## type [ChannelPublisher](<https://github.com/alehatsman/mooncake/blob/master/internal/events/publisher.go#L23-L32>)

ChannelPublisher implements Publisher using buffered channels

```go
type ChannelPublisher struct {
    // contains filtered or unexported fields
}
```

<a name="ChannelPublisher.Close"></a>
### func \(\*ChannelPublisher\) [Close](<https://github.com/alehatsman/mooncake/blob/master/internal/events/publisher.go#L125>)

```go
func (p *ChannelPublisher) Close()
```

Close closes the publisher and all subscriber channels

<a name="ChannelPublisher.Flush"></a>
### func \(\*ChannelPublisher\) [Flush](<https://github.com/alehatsman/mooncake/blob/master/internal/events/publisher.go#L115>)

```go
func (p *ChannelPublisher) Flush()
```

Flush waits for all pending events to be processed by subscribers

<a name="ChannelPublisher.Publish"></a>
### func \(\*ChannelPublisher\) [Publish](<https://github.com/alehatsman/mooncake/blob/master/internal/events/publisher.go#L46>)

```go
func (p *ChannelPublisher) Publish(event Event)
```

Publish sends an event to all subscribers This is non\-blocking \- if a subscriber's channel is full, the event is dropped

<a name="ChannelPublisher.Subscribe"></a>
### func \(\*ChannelPublisher\) [Subscribe](<https://github.com/alehatsman/mooncake/blob/master/internal/events/publisher.go#L68>)

```go
func (p *ChannelPublisher) Subscribe(subscriber Subscriber) int
```

Subscribe adds a new subscriber and returns its ID

<a name="ChannelPublisher.Unsubscribe"></a>
### func \(\*ChannelPublisher\) [Unsubscribe](<https://github.com/alehatsman/mooncake/blob/master/internal/events/publisher.go#L104>)

```go
func (p *ChannelPublisher) Unsubscribe(id int)
```

Unsubscribe removes a subscriber

<a name="Event"></a>
## type [Event](<https://github.com/alehatsman/mooncake/blob/master/internal/events/event.go#L11-L15>)

Event represents a single event in the execution lifecycle

```go
type Event struct {
    Type      EventType   `json:"type"`
    Timestamp time.Time   `json:"timestamp"`
    Data      interface{} `json:"data"`
}
```

<a name="EventType"></a>
## type [EventType](<https://github.com/alehatsman/mooncake/blob/master/internal/events/event.go#L18>)

EventType identifies the type of event

```go
type EventType string
```

<a name="EventRunStarted"></a>Event types for run lifecycle

```go
const (
    EventRunStarted   EventType = "run.started"
    EventPlanLoaded   EventType = "plan.loaded"
    EventRunCompleted EventType = "run.completed"
)
```

<a name="EventStepStarted"></a>Event types for step lifecycle

```go
const (
    EventStepStarted   EventType = "step.started"
    EventStepCompleted EventType = "step.completed"
    EventStepSkipped   EventType = "step.skipped"
    EventStepFailed    EventType = "step.failed"
)
```

<a name="EventStepStdout"></a>Event types for output streaming

```go
const (
    EventStepStdout EventType = "step.stdout"
    EventStepStderr EventType = "step.stderr"
    EventStepDebug  EventType = "step.debug"
)
```

<a name="EventFileCreated"></a>Event types for file operations

```go
const (
    EventFileCreated        EventType = "file.created"
    EventFileUpdated        EventType = "file.updated"
    EventFileRemoved        EventType = "file.removed"
    EventFileCopied         EventType = "file.copied"
    EventFileDownloaded     EventType = "file.downloaded"
    EventDirCreated         EventType = "directory.created"
    EventDirRemoved         EventType = "directory.removed"
    EventLinkCreated        EventType = "link.created"
    EventPermissionsChanged EventType = "permissions.changed"
    EventTemplateRender     EventType = "template.rendered"
    EventArchiveExtracted   EventType = "archive.extracted"
)
```

<a name="EventVarsSet"></a>Event types for variables

```go
const (
    EventVarsSet    EventType = "variables.set"
    EventVarsLoaded EventType = "variables.loaded"
)
```

<a name="EventAssertPassed"></a>Event types for assertions

```go
const (
    EventAssertPassed EventType = "assert.passed"
    EventAssertFailed EventType = "assert.failed"
)
```

<a name="EventPresetExpanded"></a>Event types for presets

```go
const (
    EventPresetExpanded  EventType = "preset.expanded"
    EventPresetCompleted EventType = "preset.completed"
)
```

<a name="EventPackageManaged"></a>Event types for package management

```go
const (
    EventPackageManaged EventType = "package.managed"
)
```

<a name="EventPrintMessage"></a>Event types for print

```go
const (
    EventPrintMessage EventType = "print.message"
)
```

<a name="EventServiceManaged"></a>Event types for service management

```go
const (
    EventServiceManaged EventType = "service.managed"
)
```

<a name="FileCopiedData"></a>
## type [FileCopiedData](<https://github.com/alehatsman/mooncake/blob/master/internal/events/event.go#L207-L214>)

FileCopiedData contains data for file.copied events

```go
type FileCopiedData struct {
    Src       string `json:"src"`
    Dest      string `json:"dest"`
    SizeBytes int64  `json:"size_bytes"`
    Mode      string `json:"mode"`
    Checksum  string `json:"checksum,omitempty"`
    DryRun    bool   `json:"dry_run"`
}
```

<a name="FileDownloadedData"></a>
## type [FileDownloadedData](<https://github.com/alehatsman/mooncake/blob/master/internal/events/event.go#L217-L224>)

FileDownloadedData contains data for file.downloaded events

```go
type FileDownloadedData struct {
    URL       string `json:"url"`
    Dest      string `json:"dest"`
    SizeBytes int64  `json:"size_bytes"`
    Mode      string `json:"mode"`
    Checksum  string `json:"checksum,omitempty"`
    DryRun    bool   `json:"dry_run"`
}
```

<a name="FileOperationData"></a>
## type [FileOperationData](<https://github.com/alehatsman/mooncake/blob/master/internal/events/event.go#L172-L178>)

FileOperationData contains data for file operation events

```go
type FileOperationData struct {
    Path      string `json:"path"`
    Mode      string `json:"mode,omitempty"`
    SizeBytes int64  `json:"size_bytes,omitempty"`
    Changed   bool   `json:"changed"`
    DryRun    bool   `json:"dry_run"`
}
```

<a name="FileRemovedData"></a>
## type [FileRemovedData](<https://github.com/alehatsman/mooncake/blob/master/internal/events/event.go#L181-L186>)

FileRemovedData contains data for file/directory removal events

```go
type FileRemovedData struct {
    Path      string `json:"path"`
    WasDir    bool   `json:"was_dir"`
    SizeBytes int64  `json:"size_bytes,omitempty"`
    DryRun    bool   `json:"dry_run"`
}
```

<a name="LinkCreatedData"></a>
## type [LinkCreatedData](<https://github.com/alehatsman/mooncake/blob/master/internal/events/event.go#L189-L194>)

LinkCreatedData contains data for link creation events

```go
type LinkCreatedData struct {
    Src    string `json:"src"`
    Dest   string `json:"dest"`
    Type   string `json:"type"` // "symlink" or "hardlink"
    DryRun bool   `json:"dry_run"`
}
```

<a name="PermissionsChangedData"></a>
## type [PermissionsChangedData](<https://github.com/alehatsman/mooncake/blob/master/internal/events/event.go#L197-L204>)

PermissionsChangedData contains data for permissions.changed events

```go
type PermissionsChangedData struct {
    Path      string `json:"path"`
    Mode      string `json:"mode,omitempty"`
    Owner     string `json:"owner,omitempty"`
    Group     string `json:"group,omitempty"`
    Recursive bool   `json:"recursive"`
    DryRun    bool   `json:"dry_run"`
}
```

<a name="PlanLoadedData"></a>
## type [PlanLoadedData](<https://github.com/alehatsman/mooncake/blob/master/internal/events/event.go#L99-L103>)

PlanLoadedData contains data for plan.loaded events

```go
type PlanLoadedData struct {
    RootFile   string   `json:"root_file"`
    TotalSteps int      `json:"total_steps"`
    Tags       []string `json:"tags,omitempty"`
}
```

<a name="PresetData"></a>
## type [PresetData](<https://github.com/alehatsman/mooncake/blob/master/internal/events/event.go#L283-L288>)

PresetData contains data for preset events

```go
type PresetData struct {
    Name       string                 `json:"name"`                 // Preset name
    Parameters map[string]interface{} `json:"parameters,omitempty"` // Parameters passed to preset
    StepsCount int                    `json:"steps_count"`          // Number of steps in preset
    Changed    bool                   `json:"changed,omitempty"`    // Whether any step changed (only in completed event)
}
```

<a name="PrintData"></a>
## type [PrintData](<https://github.com/alehatsman/mooncake/blob/master/internal/events/event.go#L291-L293>)

PrintData contains data for print.message events

```go
type PrintData struct {
    Message string `json:"message"` // The message that was printed
}
```

<a name="Publisher"></a>
## type [Publisher](<https://github.com/alehatsman/mooncake/blob/master/internal/events/publisher.go#L8-L14>)

Publisher publishes events to subscribers

```go
type Publisher interface {
    Publish(event Event)
    Subscribe(subscriber Subscriber) int
    Unsubscribe(id int)
    Flush()
    Close()
}
```

<a name="NewPublisher"></a>
### func [NewPublisher](<https://github.com/alehatsman/mooncake/blob/master/internal/events/publisher.go#L35>)

```go
func NewPublisher() Publisher
```

NewPublisher creates a new channel\-based event publisher

<a name="NewSyncPublisher"></a>
### func [NewSyncPublisher](<https://github.com/alehatsman/mooncake/blob/master/internal/events/publisher.go#L155>)

```go
func NewSyncPublisher() Publisher
```

NewSyncPublisher creates a new synchronous event publisher for testing.

<a name="RunCompletedData"></a>
## type [RunCompletedData](<https://github.com/alehatsman/mooncake/blob/master/internal/events/event.go#L106-L115>)

RunCompletedData contains data for run.completed events

```go
type RunCompletedData struct {
    TotalSteps   int    `json:"total_steps"`
    SuccessSteps int    `json:"success_steps"`
    FailedSteps  int    `json:"failed_steps"`
    SkippedSteps int    `json:"skipped_steps"`
    ChangedSteps int    `json:"changed_steps"`
    DurationMs   int64  `json:"duration_ms"`
    Success      bool   `json:"success"`
    ErrorMessage string `json:"error_message,omitempty"`
}
```

<a name="RunStartedData"></a>
## type [RunStartedData](<https://github.com/alehatsman/mooncake/blob/master/internal/events/event.go#L91-L96>)

RunStartedData contains data for run.started events

```go
type RunStartedData struct {
    RootFile   string   `json:"root_file"`
    Tags       []string `json:"tags,omitempty"`
    DryRun     bool     `json:"dry_run"`
    TotalSteps int      `json:"total_steps"`
}
```

<a name="ServiceManagementData"></a>
## type [ServiceManagementData](<https://github.com/alehatsman/mooncake/blob/master/internal/events/event.go#L264-L271>)

ServiceManagementData contains data for service.managed events

```go
type ServiceManagementData struct {
    Service    string   `json:"service"`              // Service name
    State      string   `json:"state,omitempty"`      // Desired state (started/stopped/restarted/reloaded)
    Enabled    *bool    `json:"enabled,omitempty"`    // Enabled status
    Changed    bool     `json:"changed"`              // Whether changes were made
    Operations []string `json:"operations,omitempty"` // List of operations performed
    DryRun     bool     `json:"dry_run"`
}
```

<a name="StepCompletedData"></a>
## type [StepCompletedData](<https://github.com/alehatsman/mooncake/blob/master/internal/events/event.go#L132-L141>)

StepCompletedData contains data for step.completed events

```go
type StepCompletedData struct {
    StepID     string                 `json:"step_id"`
    Name       string                 `json:"name"`
    Level      int                    `json:"level"`
    DurationMs int64                  `json:"duration_ms"`
    Changed    bool                   `json:"changed"`
    Result     map[string]interface{} `json:"result,omitempty"`
    Depth      int                    `json:"depth,omitempty"` // Directory depth for filetree items
    DryRun     bool                   `json:"dry_run"`
}
```

<a name="StepFailedData"></a>
## type [StepFailedData](<https://github.com/alehatsman/mooncake/blob/master/internal/events/event.go#L153-L161>)

StepFailedData contains data for step.failed events

```go
type StepFailedData struct {
    StepID       string `json:"step_id"`
    Name         string `json:"name"`
    Level        int    `json:"level"`
    ErrorMessage string `json:"error_message"`
    DurationMs   int64  `json:"duration_ms"`
    Depth        int    `json:"depth,omitempty"` // Directory depth for filetree items
    DryRun       bool   `json:"dry_run"`
}
```

<a name="StepOutputData"></a>
## type [StepOutputData](<https://github.com/alehatsman/mooncake/blob/master/internal/events/event.go#L164-L169>)

StepOutputData contains data for step.stdout/stderr events

```go
type StepOutputData struct {
    StepID     string `json:"step_id"`
    Stream     string `json:"stream"` // "stdout" or "stderr"
    Line       string `json:"line"`
    LineNumber int    `json:"line_number"`
}
```

<a name="StepSkippedData"></a>
## type [StepSkippedData](<https://github.com/alehatsman/mooncake/blob/master/internal/events/event.go#L144-L150>)

StepSkippedData contains data for step.skipped events

```go
type StepSkippedData struct {
    StepID string `json:"step_id"`
    Name   string `json:"name"`
    Level  int    `json:"level"`
    Reason string `json:"reason"`
    Depth  int    `json:"depth,omitempty"` // Directory depth for filetree items
}
```

<a name="StepStartedData"></a>
## type [StepStartedData](<https://github.com/alehatsman/mooncake/blob/master/internal/events/event.go#L118-L129>)

StepStartedData contains data for step.started events

```go
type StepStartedData struct {
    StepID     string            `json:"step_id"`
    Name       string            `json:"name"`
    Level      int               `json:"level"`
    GlobalStep int               `json:"global_step"`
    Action     string            `json:"action"`
    Tags       []string          `json:"tags,omitempty"`
    When       string            `json:"when,omitempty"`
    Vars       map[string]string `json:"vars,omitempty"`
    Depth      int               `json:"depth,omitempty"` // Directory depth for filetree items
    DryRun     bool              `json:"dry_run"`
}
```

<a name="Subscriber"></a>
## type [Subscriber](<https://github.com/alehatsman/mooncake/blob/master/internal/events/publisher.go#L17-L20>)

Subscriber receives events from a publisher

```go
type Subscriber interface {
    OnEvent(event Event)
    Close()
}
```

<a name="SyncPublisher"></a>
## type [SyncPublisher](<https://github.com/alehatsman/mooncake/blob/master/internal/events/publisher.go#L147-L152>)

SyncPublisher implements Publisher with synchronous event delivery. Events are delivered immediately via direct OnEvent\(\) calls. This is useful for tests to avoid race conditions with async delivery.

```go
type SyncPublisher struct {
    // contains filtered or unexported fields
}
```

<a name="SyncPublisher.Close"></a>
### func \(\*SyncPublisher\) [Close](<https://github.com/alehatsman/mooncake/blob/master/internal/events/publisher.go#L205>)

```go
func (p *SyncPublisher) Close()
```

Close closes the publisher.

<a name="SyncPublisher.Flush"></a>
### func \(\*SyncPublisher\) [Flush](<https://github.com/alehatsman/mooncake/blob/master/internal/events/publisher.go#L200>)

```go
func (p *SyncPublisher) Flush()
```

Flush is a no\-op for SyncPublisher \(already synchronous\).

<a name="SyncPublisher.Publish"></a>
### func \(\*SyncPublisher\) [Publish](<https://github.com/alehatsman/mooncake/blob/master/internal/events/publisher.go#L163>)

```go
func (p *SyncPublisher) Publish(event Event)
```

Publish sends an event to all subscribers synchronously.

<a name="SyncPublisher.Subscribe"></a>
### func \(\*SyncPublisher\) [Subscribe](<https://github.com/alehatsman/mooncake/blob/master/internal/events/publisher.go#L177>)

```go
func (p *SyncPublisher) Subscribe(subscriber Subscriber) int
```

Subscribe adds a new subscriber and returns its ID.

<a name="SyncPublisher.Unsubscribe"></a>
### func \(\*SyncPublisher\) [Unsubscribe](<https://github.com/alehatsman/mooncake/blob/master/internal/events/publisher.go#L192>)

```go
func (p *SyncPublisher) Unsubscribe(id int)
```

Unsubscribe removes a subscriber.

<a name="TemplateRenderData"></a>
## type [TemplateRenderData](<https://github.com/alehatsman/mooncake/blob/master/internal/events/event.go#L227-L233>)

TemplateRenderData contains data for template.rendered events

```go
type TemplateRenderData struct {
    TemplatePath string `json:"template_path"`
    DestPath     string `json:"dest_path"`
    SizeBytes    int64  `json:"size_bytes"`
    Changed      bool   `json:"changed"`
    DryRun       bool   `json:"dry_run"`
}
```

<a name="VarsLoadedData"></a>
## type [VarsLoadedData](<https://github.com/alehatsman/mooncake/blob/master/internal/events/event.go#L243-L248>)

VarsLoadedData contains data for variables.loaded events

```go
type VarsLoadedData struct {
    FilePath string   `json:"file_path"`
    Count    int      `json:"count"`
    Keys     []string `json:"keys"`
    DryRun   bool     `json:"dry_run"`
}
```

<a name="VarsSetData"></a>
## type [VarsSetData](<https://github.com/alehatsman/mooncake/blob/master/internal/events/event.go#L236-L240>)

VarsSetData contains data for variables.set events

```go
type VarsSetData struct {
    Count  int      `json:"count"`
    Keys   []string `json:"keys"`
    DryRun bool     `json:"dry_run"`
}
```

Generated by [gomarkdoc](<https://github.com/princjef/gomarkdoc>)
