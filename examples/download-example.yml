# Basic download with checksum verification
- name: Download Go tarball
  download:
    url: "https://go.dev/dl/go1.21.5.linux-amd64.tar.gz"
    dest: "/tmp/go.tar.gz"
    checksum: "e2bc0b3e4b64111ec117295c088bde5f00eeed1567999ff77bc859d7df70078e"
    mode: "0644"
  register: go_download

# Download with timeout and retries
- name: Download with retry logic
  download:
    url: "https://releases.ubuntu.com/22.04/ubuntu-22.04.3-live-server-amd64.iso.zsync"
    dest: "/tmp/ubuntu.iso.zsync"
    timeout: "30s"
    retries: 3
    mode: "0644"

# Download with custom headers (e.g., for authenticated APIs)
- name: Download with authorization
  download:
    url: "https://api.example.com/files/document.pdf"
    dest: "/tmp/document.pdf"
    headers:
      Authorization: "Bearer {{ api_token }}"
      User-Agent: "Mooncake/1.0"
    mode: "0644"
  when: api_token is defined

# Download with backup
- name: Download config file with backup
  download:
    url: "https://example.com/config/app.conf"
    dest: "/etc/myapp/app.conf"
    backup: true
    force: true
    become: true

# Idempotent download using checksum
- name: Download and verify Node.js (idempotent)
  download:
    url: "https://nodejs.org/dist/v18.19.0/node-v18.19.0-linux-x64.tar.gz"
    dest: "/tmp/node.tar.gz"
    checksum: "f27e33ebe5a0c2ec8d5d6b5f5c7c2c0c1c3f7b1a2a3d4e5f6g7h8i9j0k1l2m3n"
    mode: "0644"
  register: node_download

- name: Show download result
  shell: "echo 'Download changed: {{ node_download.changed }}' && ls -lh /tmp/node.tar.gz"
  when: node_download.changed

# Conditional download
- name: Download only if file doesn't exist
  download:
    url: "https://github.com/moby/moby/raw/master/README.md"
    dest: "/tmp/docker-readme.md"
    mode: "0644"
  creates: "/tmp/docker-readme.md"
